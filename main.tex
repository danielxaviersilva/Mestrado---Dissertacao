\documentclass[
    % -- opções da classe memoir --
    12pt,                % tamanho da fonte
    %openright,            % capítulos começam em pág ímpar (insere página vazia caso preciso)
    oneside,            % twoside para impressão em verso e anverso. Oposto a oneside
    a4paper,            % tamanho do papel.
    % -- opções da classe abntex2 --
    %section=TITLE,        % títulos de capítulos convertidos em letras maiúsculas
    %section=TITLE,        % títulos de seções convertidos em letras maiúsculas
    %subsection=TITLE,    % títulos de subseções convertidos em letras maiúsculas
    %subsubsection=TITLE,% títulos de subsubseções convertidos em letras maiúsculas
    % -- opções do pacote babel --
    english,            % idioma adicional para hifenização
    french,                % idioma adicional para hifenização
    spanish,            % idioma adicional para hifenização
    brazil                % o último idioma é o principal do documento
    ]{abntex2}

% ---
% Pacotes básicos
% ---
\usepackage{lmodern}            % Usa a fonte Latin Modern            
\usepackage[T1]{fontenc}        % Selecao de codigos de fonte.
\usepackage[utf8]{inputenc}        % Codificacao do documento (conversão automática dos acentos)
\usepackage{indentfirst}        % Indenta o primeiro parágrafo de cada seção.
\usepackage{lastpage}            % Usado pela Ficha catalográfica

\usepackage{color}                % Controle das cores
%\usepackage[demo]{graphicx}
\usepackage{graphicx}            % Inclusão de gráficos
\usepackage{microtype}             % para melhorias de justificação
\usepackage{amsmath}

%para R chique e curvo
\usepackage{mathrsfs}

\usepackage[position=bottom]{subfig}
%\usepackage[hang]{subfigure}
%\usepackage{subfigure}

%\usepackage[utf8]{inputenc}
\usepackage{algorithm}
\usepackage{algpseudocode}
%\usepackage{algorithm2e}

\makeatletter
\renewcommand{\ALG@name}{Algoritmo}
\makeatother
\renewcommand{\listalgorithmname}{Lista de Algoritmos}

\usepackage[brazil]{babel}
\usepackage[justification=centering]{caption}

%\newcommand\algorithmicprocedure{\textbf{procedure}}
%\newcommand{\algorithmicendprocedure}{\algorithmicend\ \algorithmicprocedure}
%\makeatletter
%\newcommand\PROCEDURE[3][default]{%
%  \ALC@it
%  \algorithmicprocedure\ \textsc{#2}(#3)%
%  \ALC@com{#1}%
%  \begin{ALC@prc}%
%}
%\newcommand\ENDPROCEDURE{%
%  \end{ALC@prc}%
%  \ifthenelse{\boolean{ALC@noend}}{}{%
%    \ALC@it\algorithmicendprocedure
%  }%
%}
\newenvironment{ALC@prc}{\begin{ALC@g}}{\end{ALC@g}}
\makeatother

\algnewcommand\algorithmicforeach{\textbf{for each}}
\algdef{S}[FOR]{ForEach}[1]{\algorithmicforeach\ #1\ \algorithmicdo}


% adicionado por Ting
\setlength{\marginparwidth}{2cm}
\usepackage[disable]{todonotes}
%\usepackage{todonotes}
%\usepackage{soul}
\usepackage[normalem]{ulem}
\usepackage{hyperref}

%\setlength\afterchapskip{\lineskip}




% ---
        
% ---
% Pacotes adicionais, usados apenas no \^{a}mbito do Modelo Can\^{o}nico do abnteX2
% ---
\usepackage{lipsum}				% para gera\c{c}\~{a}o de dummy text
\usepackage{nomencl}
\usepackage{amsmath}
\usepackage{bbm}
\usepackage{multirow}
\usepackage{rotating}
\usepackage{pdfpages}
%\usepackage[font=footnotesize]{subfig}
\usepackage{booktabs}
\usepackage{pdflscape}
\usepackage{chngcntr}
\usepackage{amsmath,amsfonts,amssymb}

\usepackage{algorithm}

\usepackage{amsmath,amsfonts,amssymb}


%\let\printglossary\relax
%\let\theglossary\relax
%\let\endtheglossary\relax

\usepackage[nonumberlist,acronym,nomain]{glossaries} % nonnumberlist nao mostra as paginas nas quais os acronimos aparecem no texto
%\newglossary[tlg]{simbolos}{tld}{tdn}{Lista de símbolos}
% Generate the glossary
%\makeglossaries


\counterwithin{figure}{chapter}
\counterwithin{table}{chapter}
% Pacotes de citações
% ---
\usepackage[brazilian,hyperpageref]{backref}     % Paginas com as citações na bibl
\usepackage[alf]{abntex2cite}    % Citações padrão ABNT

\usepackage{unicamp}

\DeclareRobustCommand{\difusao}{d}

% ---
% CONFiguraÇÕES DE PACOTES
% ---

% ---
% ConFigurações do pacote backref
% Usado sem a opção hyperpageref de backref
\renewcommand{\backrefpagesname}{Citado na(s) página(s):~}
% Texto padrão antes do número das páginas
\renewcommand{\backref}{}
% Define os textos da citação
\renewcommand*{\backrefalt}[4]{
    \ifcase #1 %
        Nenhuma citação no texto.%
    \or
        Citado na página #2.%
    \else
        Citado #1 vezes nas páginas #2.%
    \fi}%
% ---

%Redefinições de comando para pseudocódigo - Portugues
% Declaracoes em Português
%\algrenewcommand\algorithmicend{\textbf{fim}}
%\algrenewcommand\algorithmicdo{\textbf{faça}}
%\algrenewcommand\algorithmicwhile{\textbf{enqua%nto}}
%\algrenewcommand\algorithmicfor{\textbf{para}}
%\algrenewcommand\algorithmicif{\textbf{se}}
%\algrenewcommand\algorithmicthen{\textbf{então}%}
%\algrenewcommand\algorithmicelse{\textbf{senão}%}
%\algrenewcommand\algorithmicreturn{\textbf{devo%lve}}
%\algrenewcommand\algorithmicfunction{\textbf{fu%nção}}
%
%% Rearranja os finais de cada estrutura
%\algrenewtext{EndWhile}{\algorithmicend\ %\algorithmicwhile}
%\algrenewtext{EndFor}{\algorithmicend\ %\algorithmicfor}
%\algrenewtext{EndIf}{\algorithmicend\ %\algorithmicif}
%\algrenewtext{EndFunction}{\algorithmicend\ %\algorithmicfunction}
%
%% O comando For, a seguir, retorna 'para #1 -- %#2 até #3 faça'
%\algnewcommand\algorithmicto{\textbf{até}}
%\algrenewtext{For}[3]%
%{\algorithmicfor\ #1 $\gets$ #2 \algorithmicto\ %#3 \algorithmicdo}

% ---


% ---
% Informações de dados para CAPA e FOLHA DE ROSTO
% ---

%\tipotrabalho{Relatório de Qualificação de Mestrado}
% O preambulo deve conter o tipo do trabalho, o objetivo,
% o nome da instituição e a área de concentração

% ---


% ---
% Configurações de aparência do PDF final

% alterando o aspecto da cor azul
\definecolor{blue}{RGB}{41,5,195}

% informações do PDF
\makeatletter
\hypersetup{
         %pagebackref=true,
        pdftitle={\@title},
        pdfauthor={\@author},
        pdfsubject={\imprimirpreambulo},
        pdfcreator={LaTeX with abnTeX2},
        pdfkeywords={abnt}{latex}{abntex}{abntex2}{trabalho acadêmico},
        colorlinks=true,               % false: boxed links; true: colored links
        linkcolor= blue,              % color of internal links
        citecolor=blue,                % color of links to bibliography
        filecolor=magenta,              % color of file links
        urlcolor=blue,
        bookmarksdepth=4
}
\makeatother
% ---

% ---
% Espaçamentos entre linhas e parágrafos
% ---

% O tamanho do parágrafo é dado por:
\setlength{\parindent}{2cm}

% Controle do espaçamento entre um parágrafo e outro:
\setlength{\parskip}{0.2cm}  % tente também \onelineskip

\setlength\afterchapskip{\lineskip}

\titulo{Visualização Interativa de Funções de Distribuição de Orientações de Difusão Intravóxel}
\autor{Daniel Xavier Silva}
\orientador{Profa. Dr.-Ing. Wu Shin-Ting}
\local{Campinas}
\data{2021}
\instituicao{%
  UNIVERSIDADE ESTADUAL DE CAMPINAS
    \par
    Faculdade de Engenharia Elétrica e de Computação
  %Departamento de Engenharia de Computação e Automação Industrial - DCA\par
  %Faculdade de Engenharia Elétrica e de Computação - FEEC
  }
  \tipotrabalho{Dissertação (Mestrado)}
  \preambulo{Dissertação apresentada à Faculdade de Engenharia Elétrica e de Computação da Universidade Estadual de Campinas como parte dos requisitos exigidos para a obtenção do título de Mestre em Engenharia Elétrica, na Área de Engenharia de Computação.}

% ---
% compila o indice
% ---
\makeindex
% ---

% ----
% Início do documento
% ----

\begin{document}



% ----------------------------------------------------------
% ELEMENTOS PRÉ-TEXTUAIS
% ----------------------------------------------------------
% \pretextual

% ---
% Capa
% ---
% ---

\imprimircapa
% ---
% Folha de rosto
% (o * indica que haverá a ficha bibliográfica)
% ---
\imprimirfolhaderosto*
% ---

% ---
% Inserir a ficha bibliografica
% ---
\begin{fichacatalografica}
    \vspace*{\fill}
    \begin{center}
        \textsc{Inclua aqui o pdf com a ficha catalogr\'{a}fica fornecida pela BAE.}
    \end{center}
    \vspace*{\fill}
    %\includepdf{fig_ficha_catalografica.pdf}
\end{fichacatalografica}

% Isto é um exemplo de Ficha Catalográfica, ou ``Dados internacionais de
% catalogação-na-publicação''. Você pode utilizar este modelo como referência.
% Porém, provavelmente a biblioteca da sua universidade lhe fornecerá um PDF
% com a ficha catalográfica definitiva após a defesa do trabalho. Quando estiver
% com o documento, salve-o como PDF no diretório do seu projeto e substitua todo
% o conteúdo de implementação deste arquivo pelo comando abaixo:
%
% \begin{fichacatalografica}
%     \includepdf{fig_ficha_catalografica.pdf}
% \end{fichacatalografica}
% \begin{fichacatalografica}
%     \vspace*{\fill}                    % Posição vertical
%     \hrule                            % Linha horizontal
%     \begin{center}                    % Minipage Centralizado
%     \begin{minipage}[c]{12.5cm}        % Largura
    
%     \imprimirautor
    
%     \hspace{0.5cm} \imprimirtitulo  / \imprimirautor. --
%     \imprimirlocal, \imprimirdata-
    
%     \hspace{0.5cm} \pageref{LastPage} p. : il. (algumas color.) ; 30 cm.\\
    
%     \hspace{0.5cm} \imprimirorientadorRotulo~\imprimirorientador\\
    
%     \hspace{0.5cm}
%     \parbox[t]{\textwidth}{\imprimirtipotrabalho~--~\imprimirinstituicao,
%     \imprimirdata.}\\
    
%     \hspace{0.5cm}
%         1. Palavra-chave1.
%         2. Palavra-chave2.
%         I. Orientador.
%         II. Universidade xxx.
%         III. Faculdade de xxx.
%         IV. Título\\             
    
%     \hspace{8.75cm} CDU 02:141:005.7\\
    
%     \end{minipage}
%     \end{center}
%     \hrule
% \end{fichacatalografica}


% \includepdf{folhadeaprovacao_final.pdf}
%
% --- Inserir folha de aprova\c{c}\~{a}o ---

% Isto \'{e} um exemplo de Folha de aprova\c{c}\~{a}o, elemento obrigat\'{o}rio da NBR
% 14724/2011 (se\c{c}\~{a}o 4.2.1.3). Voc\^{e} pode utilizar este modelo at\'{e} a aprova\c{c}\~{a}o
% do trabalho. Ap\'{o}s isso, substitua todo o conte\'{u}do deste arquivo por uma
% imagem da p\'{a}gina assinada pela banca com o comando abaixo:
%
% \begin{folhadeaprovacao}
% \includepdf{folhadeaprovacao_final.pdf}
% \end{folhadeaprovacao}
%
\begin{folhadeaprovacao}

  \begin{center}
    COMISS\~{A}O JULGADORA - DISSERTAÇÃO DE MESTRADO
    %\textsc{Inclua aqui a folha de assinaturas.}
\end{center}
\noindent
\begin{minipage}{\textwidth}\SingleSpacing
Candidato(a): Daniel Xavier Silva     RA: 229988

Data de defesa: 19 de JULHO de 2021

T\'{i}tulo da Tese: Visualização Interativa de Funções de Distribuição de Orientações de Difusão Intravóxel
\vspace{2cm}

Profa. Dr.-Ing. Wu Shin-Ting (Presidente, FEEC - UNICAMP)

Prof. Dr.-Ing. Márcio Lobo Netto (POLI-USP) - Membro Titular

Dr. Brunno Machado de Campos - (FCM - UNICAMP) - Membro Titular


\vspace{2cm}

A Ata de Defesa, com as respectivas assinaturas dos membros da Comissão Julgadora, encontra-se no SIGA (Sistema de Fluxo de Dissertação/Tese) e na Secretaria de Pós-Graduação da Faculdade de Engenharia Elétrica e de Computação.
\end{minipage}

\end{folhadeaprovacao}
% ---

% ---
% Dedicatória
% ---
\begin{dedicatoria}
   \vspace*{\fill}
   \centering
   \noindent
   \textit{Eu dedico este trabalho a minha mãe, Sueli Xavier Linhares da Silva} \vspace*{\fill}
\end{dedicatoria}
% ---

% ---
% Agradecimentos
% ---
% ---
\begin{agradecimentos}
    À Professora Dra. Wu Shin-Ting pela paciência, suporte, apoio, discussões e demanda para que eu pudesse dar o meu melhor para o trabalho.
    
    Ao grupo de pesquisa, em especial o Raphael, pelas discussões, sugestões e pelo repasse de experiências.
    
    À minha família, pelo apoio e suporte, especialmente durante os momentos mais demandantes do trabalho. Em especial, Rebeca, Mariana, Pedro, Sueli e Juraci.
    
    Ao Conselho Nacional de Desenvolvimento Científico  e Tecnológico (CNPq) pelo suporte financeiro.
\end{agradecimentos}

% ---
% Epígrafe
% ---
% \begin{epigrafe}
%     \vspace*{\fill}
% 	\begin{flushright}
% 		\textit{``Escreva aqui a sua ep\'{\i}grafe (Opcional)''\\
% 		(Cita\c{c}\~{a}o)}
% 	\end{flushright}
% \end{epigrafe}
% ---

% ---
% RESUMOS

%% resumo em português
\setlength{\absparsep}{18pt} % ajusta o espaçamento %dos parágrafos do resumo
\begin{resumo}

A ressonância magnética ponderada em difusão (DWI) é uma modalidade de imageamento que mensura a difusão de fluidos. Aplicada ao cérebro, o DWI é único no que diz respeito à quantificação deste fenômeno na água em tecido vivo. Na substância branca do cérebro, a difusão de água tem a mesma direção preferencial das fibras do cérebro, o que possibilita a inferência da sua arquitetura \textit{in-vivo} e de forma não-invasiva. Para este fim, há métodos de imageamento que modelam este fenômeno, sendo o imageamento por tensor de difusão (\textit{Diffusion Tensor Imaging}, DTI) o mais conhecido e difundido clinicamente. Os sinais de difusão são mapeados em um tensor de segunda ordem e a partir de métricas derivadas, como informações referentes à direção preferencial de difusão, possibilitam a inferência da arquitetura da substância branca e tornam viável estudos e diagnósticos baseados na conectividade do cérebro. No entanto, o modelo utilizado no DTI falha na resolução do comportamento da difusão em regiões de substância branca onde há duas ou mais populações de fibras localizadas no mesmo \textit{voxel}. Face a este problema, grupos de pesquisa passaram a propor tensores de ordem superior a 2 para modelar a difusão com o objetivo de superar o problema do DTI e possibilitar a estimativa da arquitetura da substância branca de forma mais precisa. Este trabalho tem como objetivo a integração de um tensor de alta ordem em um ambiente de visualização multimodal interativo e a proposição de um novo algoritmo para visualização da difusão intravóxel em glifos. Apresentamos uma introdução aos tensores de alta ordem  e detalhamos a implementação computacional do método Amostragem Generalizada no Espaço-Q (\textit{Generalized Q-Space Imaging}, GQI) para processamento de tensores de alta ordem, mais especificamente dos dados do imageamento de difusão de alta resolução angular (\textit{High Angular Resolution Diffusion Imaging}, HARDI). A fim de proporcionar uma visão tridimensional dos dados pós-processados, desenvolvemos um algoritmo interativo acelerado por GPU que mapeia os tensores de alta ordem em glifos. Integramos o algoritmo num ambiente de visualização multimodal para validação. Os resultados demonstraram que os glifos propiciam a inferência da trajetória de fibras subjacentes e avaliação dos dados gerados, que é fundamental para pesquisa na área.


\vspace{\onelineskip}
\noindent\textbf{Palavras-chave}: Visualização, Renderização Volumétrica, Imageamento de Ressonância Magnética ponderada em Difusão, Imageamento de Alta Resolução Angular ponderada em Difusão, Funções de Distribuição de Orientações de Difusão, Glifos (Métodos Gráficos).
\end{resumo}
\pagebreak
%
%% resumo em inglês
\begin{resumo}[Abstract]
 \begin{otherlanguage*}{english}

Diffusion-weighted magnetic resonance (DWI) is an imaging modality that measures fluid diffusion. Applied to the brain, DWI is unique in quantifying this phenomenon in water in living tissue. In the white matter of the brain, the diffusion has the preferential direction of its fibers, which allows the inference of their architecture \textit{in-vivo} and noninvasively. For this purpose, there are imaging methods that model this phenomenon, and diffusion tensor imaging (DTI) is the most well-known and clinically disseminated. The diffusion signals are mapped to a second-order tensor. From the tensor metrics, such as information regarding the preferred direction of diffusion, it is possible to infer the white matter architecture and make studies and diagnoses viable. However, the model used in DTI cannot resolve regions of white matter where there are two or more fiber populations in the same voxel. Facing this problem, research groups have proposed higher-order tensors to model a diffusion for improving the inference of the white matter architecture. This work aims to integrate a high-order tensor in an interactive multimodal visualization environment and a novel rendering algorithm to the visualization of intravoxel diffusion in glyphs. We present an introduction to high-order tensors and detail the computational implementation of the Generalized Q-Sampling Imaging for processing higher-order tensors, namely the data of High Angular Resolution Diffusion Imaging (HARDI). We developed an interactive GPU-accelerated algorithm that maps high-order tensors data into glyphs to provide a three-dimensional view of the post-processed data. The results demonstrate that the glyphs allow inferring the underlying fiber trajectory and evaluating the generated data, which are of great use for research in the area.

%\noindent\textbf{Palavras-chave}: Visualização, Renderização Volumétrica, Ressonância Magnética ponderada em Difusão, Imageamento de Alta Resolução Angular ponderada em Difusão, Funções de Distribuição de Orientações de Difusão, Glifos (Métodos Gráficos).

\vspace{\onelineskip}
\noindent\textbf{Keywords}: Visualization, Volume Rendering, Diffusion Magnetic Resonance Imaging, High Angular Resolution Diffusion Imaging, Orientation Distribution Functions, Glyphs (Graphic Methods)
 \end{otherlanguage*}
\end{resumo}


% ---
% inserir lista de ilustrações
% ---
\pdfbookmark[0]{\listfigurename}{lof}
\listoffigures*
\cleardoublepage
% ---

% ---
% inserir lista de tabelas
% ---
\pdfbookmark[0]{\listtablename}{lot}
\listoftables*
\cleardoublepage
% ---

% ---
% inserir lista de abreviaturas e siglas
% ---
\begin{siglas}


\item[ADC] \textit{Apparent Diffusion Coefficient} (coeficiente de difusão aparente)

\item[API] \textit{Application Programming
Interface}

\item[CC] Corpo Caloso

\item[CG] Cíngulo

\item [CPU] \textit{Computer Processing Unit} (Unidade de Processamento Computacional)

\item[CS] Cortico-espinhal


\item[dODF] \textit{Diffusion Orientation Distribution Function} (Função de Distribuição de Orientações de Difusão)

\item[DSI] \textit{Diffusion Spectrum Imaging} (Imagemento por Espectro de difusão)

\item[DTI] \textit{Diffusion Tensor Imaging} (Imageamento por Tensor de Difusão)

\item[DWI] \textit{Diffusion Weighted Magnetic Resonance Imaging} (Ressonância Magnética Ponderada por Gradientes de Difusão)

\item[EPI] \textit{Echo-Planar Imaging} (Imageamento Eco-Planar)

\item[fODF] \textit{Fiber Orientation Distribution Function} (Função de Distribuição de Orientações de Fibra)

\item[FPS] \textit{frames} por segundos (quadros por segundo)

\item [GPU] \textit{Graphics Processing Unit} (Unidade de Processamento Gráfico)

\item[GQI] \textit{Generalized Q-Sampling Imaging} (amostragem generalizada no espaço Q)

\item[HARDI] \textit{High Angular Resolution Diffusion Imaging} (Imageamento de difusão por alta resolução angular)

\item[HCP] \textit{Human Connectome Project} (Projeto Conectoma Humano)

\item[ISMRM]    \textit{International Society for Magnetic Resonance in Medicine} (Sociedade Internacional para Ressonância Magnética em Medicina)

\item[MRI] Magnetic Resonance Imaging (Imageamento por Ressonância Magnética)

\item[ODF] \textit{Orientation Distribution Function} (Função de Distribuição de orientações)

\item[PGSE] \textit{Pulsed Gradient Spin Echo}

\item[SLF] \textit{Superior Longitudinal Fasciculus} (Fascículo Longitudinal Superior)



\item[UNICAMP] Universidade Estadual de Campinas

\item[VMTK-Neuro] \textit{Visual Manipulation Toolkit for NeuroImages}



%\item[CC] Corpo Caloso

%\item[GFA] \textit{Generalized Fractional Anisotropy} Anisotropia Fracionada Generalizada





\end{siglas}


% ---

% ---
% inserir lista de símbolos
% ---

% ---

% ---
% inserir o sumario
% ---
\pdfbookmark[0]{\contentsname}{toc}
\tableofcontents*
\cleardoublepage
% ---



% ----------------------------------------------------------
% ELEMENTOS TEXTUAIS
% ----------------------------------------------------------
\textual



\chapter{Introdução}
\label{sec:introducao}

A difusão molecular é um processo físico que se refere ao movimento aleatório de moléculas de fluídos que resultam da sua energia térmica \cite{lebihan2006}. 
Pode-se categorizar o movimento de difusão em relação ao meio da sua ocorrência em difusão isotrópica e anisotrópica. A difusão isotrópica é quando a difusão é igual em todas as direções. Ela ocorre em um meio que não oferece obstáculos (Fig. \ref{fig::intro_difusao_isotropica}). Enquanto na difusão anisotrópica, o meio apresenta restrições ao movimento (Fig. \ref{fig::intro_difusao_anisotropica}).

No cérebro, o processo de difusão ocorre majoritariamente com moléculas de água e difere significantemente da difusão isotrópica \cite{lebihan2006}. As moléculas interagem com os corpos celulares de neurônios (substância cinzenta) e feixes de dendritos e axônios (substância branca).
Há diferenças na forma de ocorrência da difusão nas substâncias branca e cinzenta do cérebro. Na substância cinzenta, a característica da difusão é altamente complexa devido à sua organização em camadas, o que torna a interpretação do fenômeno bem desafiadora. A substância branca, por sua vez, é composta por fibras (tratos) organizadas de forma coerente e compacta, que faz a conexão entre neurônios localizados em diferentes partes do cérebro, o que faz a difusão ter um comportamento proeminente ao longo da direção do feixe de fibras \cite{DTI_Handbook}.

A ocorrência da difusão na direção dos feixes se deve aos obstáculos impostos pelas fibras, no qual permite que a água na região entre fibras se difunda predominantemente na direção do feixe, e encontre menos obstáculos em comparação a direções mais próximas das direções perpendiculares às fibras. As barreiras ilustradas em Fig. \ref{fig::intro_difusao_anisotropica} são análogas 
às barreiras impostas pela substância branca sobre a água no cérebro.


\begin{figure}[ht]
\centering
\captionsetup[subfloat]{farskip=0pt,nearskip=0pt}
    \subfloat[Tempo = 0]{\includegraphics[width=.25\linewidth, angle=0]{figs/Introducao/Difusao_isotropica/water_molecule_t0.png}
    \label{fig::intro_difusao_isotropica_0}
    }
    \subfloat[Tempo = t]{\includegraphics[width=.25\linewidth, angle=0]{figs/Introducao/Difusao_isotropica/water_molecule_t1.png}
    \label{fig::intro_difusao_isotropica_1}
    }
    \subfloat[Tempo = 2t]{\includegraphics[width=.25\linewidth, angle=0]{figs/Introducao/Difusao_isotropica/water_molecule_t2.png}
    \label{fig::intro_difusao_isotropica_2}
    }
    \caption{Ilustração visual da difusão isotrópica. Os pontos azuis e vermelhos representam moléculas de fluidos. As moléculas em vermelho, inicialmente concentradas, se movimentam sem uma direção preferencial. \\ Fonte: \cite{voltoline2016}}
    \label{fig::intro_difusao_isotropica}
\end{figure}

\begin{figure}[ht]
\centering
\captionsetup[subfloat]{farskip=0pt,nearskip=0pt}
    \subfloat[Tempo = 0]{\includegraphics[width=.25\linewidth, angle=0]{figs/Introducao/Difusao_anisotropica/water_molecule_anisotropic_t0.png}
    \label{fig::intro_difusao_anisotropica_0}
    }
    \subfloat[Tempo = t]{\includegraphics[width=.25\linewidth, angle=0]{figs/Introducao/Difusao_anisotropica/water_molecule_anisotropic_t1.png}
    \label{fig::intro_difusao_anisotropica_1}
    }
    \subfloat[Tempo = 2t]{\includegraphics[width=.25\linewidth, angle=0]{figs/Introducao/Difusao_anisotropica/water_molecule_anisotropic_t2.png}
    \label{fig::intro_difusao_anisotropica_2}
    }
    \caption{Ilustração visual da difusão anisotrópica. Os pontos azuis e vermelhos representam moléculas de fluidos. As moléculas em vermelho, inicialmente concentradas, se movimentam de forma predominante em uma direção devido às restrições físicas em seu entorno. \\ Fonte: \cite{voltoline2016}
    }
    \label{fig::intro_difusao_anisotropica}
\end{figure}



A medição das características de difusão da água no cérebro pode fornecer informações sobre a substância branca quanto à direção de fibras e conectividade do cérebro. Esta medição é possível através da ressonância magnética ponderada por difusão (\textit{diffusion-weighted magnetic resonance imaging}, DW-MRI ou DWI), que é no estado-da-arte o único meio não-invasivo a permitir tal informação. O DWI mede a atenuação do sinal de ressonância magnética devido a uma falha na recuperação de fase dos \textit{spins} das moléculas de água, que ocorrem devido ao movimento de difusão.



%O DWI é uma forma de ressonância magnética que gera contraste a partir da difusão das moléculas de água em determinadas direções \cite{DTI_Handbook}. %A partir do sinal adquirido, há ferramentas que  possibilitam o seu mapeamento em  fibras nervosas do cérebro humano \textit{in-vivo}.

%A ressonância magnética ponderada na sequência de difusão (\textit{diffusion-weighted magnetic resonance imaging} - DW-MRI ou DWI) é uma sequência de ressonância magnética que mensura a difusão das moléculas de água em determinadas direções \cite{DTI_Handbook}. A partir do sinal adquirido, há ferramentas que  possibilitam o seu mapeamento em  fibras nervosas do cérebro humano \textit{in-vivo}.

%!!A forma mais comum para gerar o DWI é através da sequência e pulsos PGSE (\textit{Pulsed Gradient Spin Echo}).


%Na aquisição do DWI, é escaneado um conjunto de volumes em que cada um possui a ponderação de único gradiente de difusão associado a um valor-b\footnote{O valor-b é uma métrica de sensitividade para difusão e é função de parâmetros da aquisição do DWI, como função da intensidade, duração e o intervalo de tempo dos gradientes de ponderação de difusão. Quanto maior o seu valor, maior o decaimento do sinal relativo à difusão.}, e, adicionalmente, um ou mais volumes sem ponderação de gradiente, denominado volume b0. A quantidade de volumes ponderados para diferentes direções de gradiente é denominada de resolução angular.

Há diversas técnicas para sumarizar os sinais coletados em potenciais caminhos de fibras nervosas (tractografia). Essas técnicas são objeto de pesquisa desde o início dos anos 90 \cite{descoteaux2015}. Há também pesquisas na área de visualização em métodos de imageamento aplicados a aquisições DWI, tanto no que diz respeito à criação de glifos representativos do comportamento de difusão quanto à reconstrução das fibras do cérebro.

O método de imageamento mais amplamente utilizada para estes fins é chamada de imageamento por tensor de difusão (\textit{Diffusion Tensor Imaging}, DTI), proposto por \citeonline{Basser1994}. Representando a difusão molecular de água como um modelo Gaussiano de dispersão, o DTI consiste em um mapeamento, por ponto no espaço, dos sinais de difusão em tensores de ordem 2, representáveis por matrizes 3x3 simétricas. A informação referente ao processo de difusão é comumente extraída dos três autovetores e autovalores dessas matrizes.

%\sout{Há pesquisas na área de visualização em métodos de imageamento aplicados a aquisições DWI, tanto no que diz respeito à criação de glifos representativos do comportamento de difusão, quanto à reconstrução das fibras do cérebro -- denominada tractografia.}

\citeonline{Basser1994} e \citeonline{Kindlmann2004} propuseram glifos representativos que sintetizam a difusão por amostra a partir do DTI. A Fig. \ref{fig::intro_ex_DTI_glifos} ilustra glifos propostos por \citeonline{Kindlmann2004}, denominados superquádricos. Esses glifos são gráficos de funções superquádricos cujos coeficientes e expoentes refletem os autovalores e autovetores dos tensores de difusão.

A visualização do comportamento de difusão por amostra facilita a análise local dos sinais escaneados, mas o objetivo final da maioria das aplicações são os feixes de fibras que conectam de forma plausível as amostras locais de difusão. Técnicas usadas para tal reconstrução são conhecidas por tractografia. As fibras reconstruídas podem ser representadas por linhas, como ilustrado na Fig. \ref{fig::intro_ex_DTI_tractografia}. Algoritmos de tractografia baseados em DTI foram propostos, por exemplo, por \citeonline{Weinstein1999} e \citeonline{basser2000} e são categorizados como baseados no rastreamento de direções de difusão (\textit{streamline fiber tractography}). Esses algoritmos consistem essencialmente em conectar as amostras pelas direções dos autovetores de maior autovalor de tensores de difusão locais até um critério de parada, relacionado à chegada da linha em regiões fora da substância branca,  ser satisfeito. Informações adicionais sobre as diferentes abordagens em tractografia podem ser encontradas em \cite{tournier2011, DTI_Handbook}.

\begin{figure}[ht]
\captionsetup[subfloat]{farskip=0pt,nearskip=0pt}
    \subfloat[Tensores de difusão representado por glifos superquádricos em uma fatia axial do cérebro na região do corpo caloso. As cores representam a direção predominante de difusão onde vermelho é lateral (esquerda-direita), azul é ascendente (superior-inferior) e verde é anteroposterior (anterior-posterior)]{\includegraphics[width=.52\linewidth, angle=0]{figs/Introducao/ex_DTI_Superquadrica.png}
    \label{fig::intro_ex_DTI_glifos}}
    \hfill
    \subfloat[Visão axial do fascículo inferior fronto-occipital (IFOF). A cor predominantemente verde indica sua trajetória, que ocorre na direção anteroposterior. As linhas são reconstruídas com base no proposto por \citeonline{Weinstein1999} ]{\includegraphics[width=.46\linewidth, angle=0]{figs/Introducao/ex_DTI_tractography.png}
    \label{fig::intro_ex_DTI_tractografia}}
    \caption{Ilustração de resultados de pesquisa na área de visualização em ressonância magnética de difusão utilizando o DTI.}
    \label{fig::intro_ex_DTI}
\end{figure}

%\todo[inline]{ Confira se as literaturas citadas abaixo são relacionadas com glifos e tractografia ... para não tirar o foco. Além de glifos, há várias formas de visualizar os dados dos tensores. Muitos trabalhos visualizam somente FA, ADC, etc.}

% \textcolor{magenta}{
% A partir da visualização de dados extraídos dos tensores, há estudos que buscam inferir sobre a substância branca e utilizá-las em diferentes estudos e diagnósticos. Como alguns exemplos, temos:
% \begin{itemize}
%     \item evidência de correlações de métricas do DTI com a degeneração do cérebro causada pela esclerose lateral amiotrófica e o seu potencial uso como biomarcador \cite{cirillo2012, baek2020};
%     \item diagnósticos de isquemia cerebral aguda em estágios iniciais, o que não é possível com MRI convencionais \cite{dong2004};
%     \item aplicação de métricas e tractografia à redes cognitivas na epilepsia do lobo temporal \cite{leyden2015}
% \end{itemize}
% }

Devido à sua natureza de modelagem, o DTI apresenta limitações. O modelo Gaussiano descreve bem regiões de fibras em que o comportamento de difusão ocorre predominantemente em uma direção. Em pontos que contém múltiplas fibras e que estão dispostas nas mais variadas configurações (por exemplo, cruzamento, bifurcação, fusão, espalhamento e
%\todo{toque? \textcolor{green}{A expressão que o pessoal usa é essa... o formato das fibras é:  ")(" é o nome toque não dá essa impressão  }}
``beijo''), o modelo Gaussiano não sintetiza de forma correta o comportamento da difusão, impedindo o cômputo das direções plausíveis para reconstrução de uma fibra de interesse \cite{fillard2011, daducci2014}. Há uma estimativa que entre 66\% a 90\% da substância branca do cérebro tem múltiplas configurações de cruzamento de fibra \cite{descoteaux2015} e a limitação do DTI é um obstáculo para traçar caminhos plausíveis dessas fibras do cérebro.

Cientes das limitações do DTI, pesquisadores da área propuseram métodos de imageamento com modelos matemáticos mais avançados e descritivos do processo de difusão, os quais passaram a demandar aquisições
%\todo{Escreveria qtdes para mostrar "mais".}
com uma quantidade maior de amostras de sinais de difusão por \textit{voxel} em comparação às aquisições utilizadas para o DTI. %Tais aquisições são denominadas imagem de difusão por \todo{Ou simplesmente alta resolução como Q-Space Imaging (QSI)}alta resolução angular  (HARDI - \textit{High Angular Resolution Diffusion Imaging}). 
A tese de doutorado de David Tuch \cite{tuch2002} é o trabalho seminal da área.




%  do tensor de difusão representam três direções ortogonais cujos respectivos autovalores representam a magnitude de difusão, que são máximos para restrição de ortogonalidade.

%\todo[inline]{Abstraindo o que você escreveu ... há duas linhas de empenho: visualização dos sinais de difusão por amostra (modelagem local da geometria das fibras) e/ou por fibra (modelagem global da conectividade das amostras). É melhor colocar Fig 1.1 e 1.2 uma ao lado da outra. Facilita análise comparativa.}








%\begin{figure}[ht]
%
%\centering
%\includegraphics[width=.485\linewidth, %angle=00]{figs/Introducao/ex_DTI_Superquadric%a.png}
%\centering
%\caption{Tensor de difusão representado por %glifos superquádricos em uma fatia axial do %cérebro na região do corpo caloso. As cores %representam a direção predominante de difusão %onde vermelho é esquerda-direita, azul é %superior-inferior e verde é %anterior-posterior}
%\label{fig::intro_ex_DTI_Superquadrica}
%\end{figure}

%\begin{figure}[ht]
%\centering
%\includegraphics[width=.485\linewidth, %angle=00]{figs/Introducao/ex_DTI_tractography%.png}
%\caption{Trato fascículo inferior %fronto-occipital (IFOF). A cor %predominantemente verde indica sua %trajetória, que ocorre na direção %anterior-posterior}
%\label{fig::intro_ex_DTI_Tractografia}
%\hfill
%\end{figure}




%\section{Motivação}
%\label{ssec:motivation}



%Uma aquisição DWI é considerada HARDI se há 45 ou mais gradientes de ponderação de difusão. Esta modalidade de aquisição se diferencia de uma aquisição DTI, que costuma possuir entre 6 a 32 direções \cite{descoteaux2015}.


%\todo{\url{https://www.researchgate.net/figure/Sampling-schemes-in-q-space-a-Cartesian-sampling-dedicated-to-diffusion-spectrum_fig3_319558026}}.

Durante a década de 2000, foram propostos métodos de imageamento mais descritivos do processo de difusão que o DTI, como demonstram os trabalhos conduzidos por Tuch \cite{tuch2002}, \cite{TuchQBall2004}, Tournier et al. \cite{tournier2007}, Wedeen et al. \cite{wedeen2005} e Yeh et al. \cite{yeh2010}. Estes métodos tinham como objetivo principal resolver o problema de orientações múltiplas de fibras dentro de um \textit{voxel} usando tensores de ordem superior a 2. Entre esses tensores temos as funções de distribuição de orientações (\textit{Orientation Distribution Function}, ODF). Para diferenciar do DTI imageamentos de tensores de alta ordem, neste trabalho chamaremos esses imageamentos de \textsf{métodos alta ordem}.
%, assim superando as limitações do DTI. 

%Durante a década de 2000, foram propostos métodos de imageamento mais descritivos do processo de difusão que o DTI . Alguns deles consistem na abordagem multi-tensor \cite{tuch2002}, o \textit{Q-Ball Imaging} (QBI) \cite{tuch2002, Kindlmann2004}, \textit{constrained spherical deconvolution} (CSD) \cite{tournier2007}, \textit{diffusion spectrum imaging} (DSI) \cite{tuch2002,wedeen2005} e a amostragem generalizada do espaço Q (GQI - \textit{generalized Q-space sampling}) \cite{yeh2010}.  no qual padrões de fibras subjacentes podem ser inferidos. Para diferenciá-los do DTI, neste trabalho chamaremos estes métodos de imageamento de \textbf{métodos HARDI}.

%Uma ODF, no contexto de DWI, consiste em uma função que associa um conjunto de direções a um valor escalar de difusividade. A representação em forma de glifos para ODFs geralmente consistem na plotagem polar esférica (\textit{spherical polar plot}) de uma ODF min-max normalizada no intervalo [0, 1] \cite{TuchQBall2004}, conforme mostrado na Fig. \ref{fig::ex_glifo_hardi}. Chamaremos esta categoria de glifos neste trabalho de \textbf{glifos ODF}. A renderização interativa desses glifos é um ponto principal deste trabalho e os trabalhos de \citeonline{shattuck2008} e \citeonline{peeters2009, almsick2011} trazem diferentes abordagens para este fim.

%\begin{figure}[h]
%   \centering
%       \addtolength{\leftskip} {-2cm} % increase (absolute) value if needed
%    \addtolength{\rightskip}{-2cm}
%
%    %\vspace*{3mm}
%    \centering
%    \includegraphics[width=.35\linewidth, angle=0]{figs/Introducao/SphericalMeshModulation.png}
%   \caption{Plotagem polar esférica de uma ODF e sua versão min-max normalizada. A normalização enfatiza a direção dominante de difusão. As cores representam a direção no espaço da superfície, onde o vermelho representa horizontal; verde, a vertical; e azul a direção normal ao plano da tela.}
%    \label{fig::ex_glifo_hardi}
%\end{figure}

%\todo[inline]{Não entendi a parte em magenta ... O texto que adicionei não se conecta com ela. "em uma função" é muito vaga. Pelo menos explicita qual tipo de função ... \textcolor{green}{feito!}}

%Os métodos de alta ordem usualmente sintetizam os sinais de difusão locais em uma 

As ODFs associam uma direção, representada pelo vetor unitário $\mathbf{\hat{u}}$, a um valor escalar de probabilidade $R(\mathbf{\hat{u}})$ representativo. Entre os métodos de alta ordem, há os que visam computar funções de distribuição de orientações de difusão (dODF) \cite{TuchQBall2004, wedeen2005, yeh2010}. A partir das dODFs, a informação sobre as fibras subjacentes intravóxel é extraída de um conjunto de direções feita através do cômputo dos máximos locais das funções. Se o cômputo das dODFs é feito a partir de aquisições com uma razão sinal-ruído razoável, as fibras tendem a ser bem modeladas através de seus máximos locais \cite{fillard2011}.

%O primeiro uso desta categoria de funções é documentado por \citeonline{tuch2002}, que mostra que há uma relação de Fourier tridimensional entre os sinais de difusão para a função de difusão. Adicionalmente, o conteúdo direcional da difusão é obtido através através da integração na coordenada radial da função de difusão.


%\textcolor{red}{Foi demonstrado por ??? \cite{???} que, sem pré-condicionar o comportamento de difusão a um modelo matemático, é possível reconstruir uma função de distribuição, também conhecida por função de densidade de probabilidade, de \todo{orientações?}direções de fibras subjacentes às amostras dos sinais escaneados.} 
%\sout{Os métodos definem transformadas que são aplicadas nas amostras dos sinais de difusão em cada \textit{voxel} em uma função, na qual a distribuição de direções de fibra subjacentes podem ser inferidas.} \textcolor{magenta}{A extração geralmente é feita através da detecção de máximos locais \todo{quais?}destas funções, nos quais, se aplicados sobre aquisições com uma relação sinal ruído razoável, tendem a modelar bem \todo{qual distribuição?}}

A partir da extração de direções fibras subjacentes, tem sido possível gerar tractografias mais coerentes com os tratos reais e que levem em consideração mais nuances do sinal de difusão que o DTI, especialmente em regiões que contém as mais diversas configurações de múltiplas fibras. Entre os trabalhos que trazem evidências da melhoria da tractografia utilizando tensores de alta ordem, temos:

\begin{itemize}
    \item \citeonline{berman2009} registrou a melhor reconstrução da conectividade do trato motor na presença de tumor;
    \item \citeonline{bucci2013} demonstraram um melhor delineamento do trato corticoespinhal utilizando um método de alta ordem em comparação ao DTI, com validação por estimulação cortical; e
    \item \citeonline{kuhnt2013} mostraram a melhora da tractografia das radiações ópticas em pacientes com glioma.
\end{itemize}
Mesmo com estas evidências, tensores de alta ordem não são popularmente utilizadas clinicamente.


%A partir das ODFs, a direção local de fibras em um \textit{voxel} é modelada de forma adequada pela extração de seus máximos locais \cite{fillard2011}, sendo assim a base para algoritmos de tractografia.  %\textcolor{red}{Porém, (comentar o que falta ainda para popularizar o seu uso clínico em relação a DTI) ...}

No uso clínico, o DTI é ainda muito mais utilizado que métodos alta ordem. As vantagens do DTI se referem a sua aquisição, que requer uma quantidade de dados menor, implicando em um menor tempo para ser feita, e a popularidade de aplicativos que processam DWI por este método de imageamento. Adicionalmente, o DTI demanda uma menor quantidade memória para armazenar parâmetros intrínsecos ao seu método comparados aos métodos de alta ordem. O cômputo de parâmetros relacionados em diferentes aplicações a partir do DTI, como o próprio cômputo do tensor, renderização de glifos e tractografia, é geralmente computacionalmente menos exigente. Face a estas dificuldades, a comunidade ainda não desenvolveu  um aplicativo que justifique os tempos de aquisição mais longos \cite{descoteaux2015}.

%Falar de tratos que HARDI resolve e DTI não?

%Em tractografia, tanto baseada em DTI, quanto HARDI, há avanços no entendimento de patologias, como esclerose múltipla, mal de Parkinson, esquizofrenia e derrame \cite{SCHILLING2019194}, e mesmo com essas aplicabilidades, há muitos desafios na área.

%Embora os máximos de ODF obtidas através de métodos HARDI consigam resolver os problemas que dizem respeito à estimativa de direções de fibras de forma local, os métodos não inferem sobre a configuração de fibras -- por exemplo, se as diferentes fibras se cruzam ou se "beijam" \cite{SCHILLING2019194}. A busca por informações adicionais para inferir a natureza da configuração entre múltiplas fibras em diferentes regiões é uma oportunidade ainda em aberto.

%%RELER O ARTIGO DO SCHILING E MOSTRAR OPORTUNIDADES 



%\todo[inline]{Sugiro mencionar aqui o artigo de Schilling et al. mostrando os desafios ainda em aberto.}

\section{Motivação e Objetivos}
\label{ssec:motivation}

Motivados pela maior fidelidade na tractografia baseada nos métodos de alta ordem, nosso grupo de pesquisa tem a intenção de desenvolver um sistema de visualização interativa de ODFs e um algoritmo de tractografia interativo baseado nessas funções ODFs integrado ao ambiente de visualização multimodal  exploratória de exames imagiológicos 3D, chamado Visual \textit{Manipulation Toolkit for NeuroImages} (VMTK-Neuro) \cite{VMTKNeuro}.  O aplicativo renderiza em tempo interativo volumes de ressonância magnética (\textit{magnetic resonance imaging} - MRI) e possui ferramentas de exploração 3D para volumes DTI, sintetizados a partir dos volumes de ressonância magnética ponderada em difusão (DWI). A exploração pode ser feita através dos glifos superquádricos, a nível de \textit{voxel} (Fig. \ref{fig::intro_ex_DTI_glifos}), ou por meio de tractografia, a nível de feixes de fibras (Fig. \ref{fig::intro_ex_DTI_tractografia}).

%Objetivando o aprimoramento de algoritmos de reconstrução de fibras já existentes, consideramos que o próximo passo para pesquisa no DWI leva em consideração a implementação de um método de alta ordem e a exploração de dados de tensores de alta ordem. 
Fig. \ref{fig::flowchart_vmtk_hardi} contextualiza a contribuição esperada do presente trabalho à arquitetura do VMTK-Neuro. Na figura destacamos os blocos que devem ser integrados ao VMTK-Neuro para visualização das funções ODFs em glifos e tractografia: 
%Baseados no fluxograma da Fig. \ref{fig::flowchart_vmtk_hardi}, podemos esquematizar os passos para visualização de ODFs em glifos e tractografia em:

\begin{enumerate}
    \item a implementação de um método de síntese dos sinais de difusão em tensores de alta ordem;
    \item a visualização multimodal intravoxel das funções de distribuição de orientações de difusão por meio de glifos;
    \item o cômputo da distribuição de fibras subjacentes \textit{voxel} a \textit{voxel}; e
    \item a implementação de um algoritmo de tractografia.
\end{enumerate}

\begin{figure}[ht]
   \centering
       \addtolength{\leftskip} {-2cm} % increase (absolute) value if needed
    \addtolength{\rightskip}{-2cm}

    %\vspace*{3mm}
    \centering
    \includegraphics[width=.9\linewidth, angle=0]{figs/Introducao/fluxograma_VMTK_HARDI.png}
    \caption{Fluxograma do ambiente de visualização multimodal para método de alta ordem para DWI. Os capítulos \ref{chapter::metodos_hardi} e \ref{chap::renderizacao_interativa_de_perfis_de_difusao} trazem o detalhamento dos blocos destacados em azul.}
    \label{fig::flowchart_vmtk_hardi}
\end{figure}

%\section{Objetivos}
%\label{sec::objetivos}


%Cumprindo estes objetivos, estaremos aptos a fazer pesquisas na área de tractografia baseadas em métodos de alta ordem, tanto no que diz respeito a contribuição em métodos e algoritmos quanto em aplicações clínicas. Sobre métodos de tractografia, \citeonline{SCHILLING2019194} menciona os desafios, oportunidades e limitações nesta área de tractografia, e menciona que a próxima evolução em tractografia há de vir a partir do uso de outras fontes de informação, no qual podemos ter futuras conjecturas para investigação em como podemos utilizar dados co-registrados em adição ao DWI para dar passos adicionais nesta área.

% do uso de métodos de alta ordem em tractografia sobre os desafios da área, temos a intenção de dar 

%Todas as implementações e experimentos do trabalho são realizados no aplicativo VMTK-Neuro (\textit{Visual Manipulation ToolKit for Neuroimages}) \cite{VMTKNeuro}, que é um ambiente de visualização exploratória multimodal multi-plataforma desenvolvida e mantida pelo grupo de pesquisa da Faculdade de Engenharia Elétrica e de Computação da UNICAMP ao qual faço parte. O \textit{software} renderiza em tempo real volumes de ressonância magnética (\textit{magnetic resonance imaging} - MRI) e possui ferramentas de exploração 3D para volumes DWI a partir do DTI, no qual há funcionalidade de exploração local a partir de glifos superquádricos e tractografia (Fig. \ref{fig::intro_ex_DTI}). 



%renderiza em tempo real volumes de ressonância magnética (\textit{magnetic resonance imaging} - MRI) e possui ferramentas de exploração 3D para volumes DWI a partir do DTI, no qual há funcionalidade de exploração local a partir de glifos superquádricos e tractografia (Fig. \ref{fig::intro_ex_DTI}).

%\todo[inline]{A motivação não está bem contextualizada, principalmente depois de ler um parágrafo só sobre as vantagens de DTI no uso clínico. Talvez caiba aqui uma referência em que os autores falam sobre desafios para tornar HARDI popular no uso clínico ... que justificaria o seu trabalho.}

%Nosso grupo de pesquisa tem a intenção de fazer um ambiente exploratório para volumes de difusão através de um método de alta ordem. Neste ambiente, \todo{Isso já não é feito com DTI?}\textcolor{magenta}{um especialista tem total liberdade para construção e análise de forma não invasiva de fibras} e para este fim, desenvolveremos um sistema de visualização interativa de perfis de difusão gerados pelo método de imageamento utilizado em glifos e um algoritmo de tractografia interativo, como ilustrado na fluxograma da Fig. \ref{fig::flowchart_vmtk_hardi}.


%Diante destes desafios em aberto, 
Este trabalho aborda a implementação de um algoritmo de renderização de glifos a partir dos dados de ODFs. Escolhemos a Amostragem Generalizada no Espaço-Q (\textit{Generalized Q-Sampling Imaging}, GQI) para a síntese dos sinais de volumes de ressonância magnética ponderada em difusão em ODFs. 
%e propomos um algoritmo para renderização interativa dos glifos que sintetizem as funções obtidas através deste método. 
Inspirados no trabalho de \citeonline{voltoline2021} que mostra que a sobreposição de glifos superquádricos sobre volumes anatômicos estruturais pode melhorar o processo de escolha de sementes em tractografia baseada em rastreamento de direções plausíveis, conjeturamos que os glifos podem proporcionar não só uma escolha mais acurada como também uma melhor estimativa das orientações intervóxeis de fibras.

%\sout{Adicionalmente, conjecturamos que o uso de glifos superquádricos posicionados em seus respectivos \textit{voxels} em um ambiente de exploração interativa pode melhorar o processo de escolha de parâmetros iniciais em tractografia \cite{voltoline2021}, o que também é válido para ODFs mapeadas em glifos, visto que esta categoria de glifos permite a inferência sobre cruzamentos de fibra presentes em ODFs, o que não ocorre com superquádricos, dada a limitação do DTI.}


%\textcolor{magenta}{A partir dele, pode-se \todo{Para qê inferir?}inferir visualmente sobre o método de imageamento utilizado quanto a sua adequabilidade para com a aquisição utilizada. Adicionalmente, há evidências que o uso de glifos superquádricos posicionados em seus respectivos \textit{voxels} em um ambiente de exploração interativa pode melhorar o processo de escolha de parâmetros iniciais em tractografia \cite{voltoline2021}, o que também é válido para glifos ODF, visto que, esta categoria de glifos permite o usuário ter a informação de cruzamento de fibras, o que não é presente nos superquádricos pela natureza do DTI.}

%Acerca do algoritmo de tractografia, a interação com um especialista é relevante nos seguintes aspectos: queremos que o usuário tenha a liberdade de escolher os tratos a serem analisados e que ele possa inferir e assegurar a plausabilidade das conexões das amostras de múltiplas orientações que métodos HARDI proveem.

%Acerca da natureza do tipo de interatividade que queremos mostrar, evidentemente que somente informações extraídas de um volume de difusão não assegura a plausabilidade de fibras reconstruídas e é desejável que haja ferramentas de interatividade para com um especialista para que ele possa escolher regiões de análise e verificar a plausabilidade de fibras.

%O conhecimento de tratos a partir de DWIs é escasso e há discrepâncias entre especialistas, não apenas na área de difusão, mas também na literatura anatômica \cite{SCHILLING2019194} e é necessária a análise humana para inferir sobre a plausabilidade do que está sendo reconstruído.





%\todo[inline]{Principal motivação é aprimorar a interatividade no processo de reconstrução de uma fibra? Diante dos desafios ainda em aberto, espera-se que, através de uma visualização interativa dos dados de difusão HARDI devidamente pré-processados, um especialista junto com uma máquina construa de forma mais fiel possível, e não-invasiva, as fibras dos tratos (conhecidos e desconhecidos)?}

%\textcolor{red}{No que diz respeito ao método de síntese de orientações das fibras a partir dos volumes HARDI, integramos a sua formulação matemática diretamente no VMTK-Neuro. Os principais critérios para sua escolha se devem a sua adequabilidade em tractografia, sua aplicabilidade em DWIs de baixa resolução angular e simplicidade em relação a quais métodos???.}

%\todo[inline]{Dentre o estado-da-arte da tecnologia HARDI, qual aspecto te chamou atenção e te motivou a desenvolver este trabalho de Mestrado com o objetivo de "implementar e validar um algoritmo (melhor?) de tractografia baseada na técnica de imageamento HARDI"? Na forma como está colocada a sua proposta leva o leitor questionar se o trabalho é simplesmente um exercício do que já se tem.}

%\textcolor{red}{O conhecimento sobre tratos é ainda precário para reconstruí-los integral e automaticamente. É necessária a análise humana para assegurar a plausibilidade das conexões das amostras de múltiplas orientações que a técnica HARDI provê. Para que um especialista possa ter uma visão sucinta e precisa sobre as informações da difusividade local de uma amostra e ajudar uma máquina tomar decisão na ligação desta amostra com as amostras vizinhas para formar uma fibra, é desejável que ele explore de forma interativa tanto os perfis de difusão em cada amostra como as fibras reconstruídas com base nas conjeturas formuladas e reformuladas.}

%\section{Ambiente de Implementação}
%\label{ssec:ambiente}

%Todas as implementações e experimentos do trabalho são realizados no aplicativo VMTK-Neuro (\textit{Visual Manipulation ToolKit for Neuroimages}) \cite{VMTKNeuro}, que é um ambiente de visualização exploratória multimodal multi-plataforma desenvolvida e mantida pelo grupo de pesquisa da Faculdade de Engenharia Elétrica e de Computação da UNICAMP ao qual faço parte. O \textit{software} renderiza em tempo real volumes de ressonância magnética (\textit{magnetic resonance imaging} - MRI) e possui ferramentas de exploração 3D para volumes DWI a partir do DTI, no qual há funcionalidade de exploração local a partir de glifos superquádricos e tractografia (Fig. \ref{fig::intro_ex_DTI}). 





%Na subseção \ref{ssec:vmtk-neuro} do capítulo Materiais e Métodos, ilustramos as ferramentas para DWI como um fluxograma e descrevemos as funcionalidades correlatas ao presente trabalho.

% conforme mostrado no fluxograma da figura \ref{fig::PipelineDTI_tracto}.%\textcolor{red}{escaneados com o protocolo Overplus \cite{Philips} e de rastreamento das fibras para volumes DTI sintetizados a partir de DWIs}\todo{não necessariamente Overplus. Overplus não sintetiza as sequencias de aquisições de DWI que há por aí.}.

%\begin{figure}[ht]
%   \centering
%       \addtolength{\leftskip} {-2cm} % increase (absolute) value if needed
%    \addtolength{\rightskip}{-2cm}
%
%    %\vspace*{3mm}
%    \centering
%    \includegraphics[width=1.0\linewidth, angle=0]{figs/Fluxogramas/PipelineDTI_tracto.jpg}
%    \caption{Fluxograma para tractografia implementado no VMTK-Neuro.}
%    \label{fig::PipelineDTI_tracto}
%\end{figure}

%Estas ferramentas consistem na visualização em tempo interativo de tensores de difusão mapeados em glifos superquádricos \cite{Kindlmann2004} renderizados sobre as suas respectivas amostras (figura \ref{fig::intro_ex_DTI_glifos}), tractografia (figura \ref{fig::intro_ex_DTI_tractografia}) e o corregistro de volumes de difusão com volumes anatômicos T1.

%Na tractografia baseada em DTI, o VMTK-Neuro possui ferramentas de interatividade que possibilitam que o usuário possa inferir sobre as regiões do volume que contém os tratos a serem analisados, bem como filtrar fibras de interesse e eliminar fibras espúrias. Adicionalmente, parâmetros relacionados a reconstrução, que podem diferir de acordo com a região de análise do usuário, também são configuráveis. O algoritmo de tractografia apresenta resultados visuais em tempo interativo para as formas de interação mencionadas.


%\todo[inline]{Acho que não foi revisado este capítulo ... Vou parar de ler ... \textcolor{green}{Escrito}}



%\sout{As ferramentas de visualização} O ambiente de visualização multimodal, que integra diferentes modalidades de neuroimagens, incluindo a ressonância de difusão modelada pelo DTI, de forma co-registrada, e, adicionalmente um algoritmo de tractografia interativo, baseado em \citeonline{Weinstein1999}.

%\todo{Motivação?}\textcolor{magenta}{Motivados} pela pesquisa que evidenciam as vantagens da tractografia baseadas em métodos mais avançados em aquisições de alta resolução angular, temos a intenção de fazer a visualização multimodal com DWIs através de algum.




%Adicionalmente, temos a conjectura que os glifos possam ser utilizados para detectar anormalidades nas neuroimagens, bem como servir de suporte visual para escolha de parâmetros iniciais em tractografia, conforme evidenciado em \citeonline{voltoline2021} para superquádricos do DTI.





\section{Contribuição}
\label{sec:contribuicoes}

A contribuição esperada para o presente trabalho dentro do escopo de um ambiente exploratório da conectividade cerebral através de técnicas avançadas de imageamento é a integração da técnica de amostragem generalizada no espaço-Q (\textit{Generalized Q-Space Imaging}, GQI) \cite{yeh2010}  ao ambiente de visualização exploratória multimodal, e a proposição de um algoritmo de renderização em tempo interativo de uma representação gráfica das funções ODF sintetizadas.
%e a proposição e validação de um algoritmo de renderização interativa de glifos que sintetizem as ODFs geradas pelo método integrado.

%\todo[inline]{Sintetizar os principais resultados alcançados ...}
Em relação aos trabalhos do nosso conhecimento, as duas principais contribuições ao estado-da-arte de renderização interativa dos glifos de ODF são: (1) a aplicação da propriedade de simetria das funções densidade de probabilidade de orientações de difusão para reduzir o volume de dados envolvidos na representação de difusão em cada \textit{voxel}, e (2) a compactação e o processamento dos dados de ODFs na GPU.


%\textcolor{red}{A expectativa é aplicar os resultados na implementação do fluxograma mostrado na Figura ??? no VMTK-Neuro ...}



%\todo[inline]{Sugiro que mostre em algum ponto uma visão geral do fluxo de controle da sua proposta de construção de tractografia a partir de DWIs de alta resolução angular.}

\section{Desafios}
\label{sec::desafios}

O VMTK-Neuro dispõe de uma série de funções para explorar as difusões intravóxeis por meio de glifos superquádricos as plausíveis conexões intervóxeis por meio de tratos reconstruídos. 
Essas funções podem ser reusadas para explorar os glifos e os tratos derivados de tensores de alta ordem. 
%Para implementação do sistema, muito da infraestrutura necessária para alcançar os objetivos estabelecidos estão implementadas no VMTK-Neuro para visualização de volumes DWI por DTI. 
Portanto, os desafios enfrentados dizem respeito à complexidade matemática dos modelos de alta ordem e às questões de implementação do método alta ordem e o seu mapeamento em glifos representativos.

%A própria implementação computacional de um método de alta ordem para sintetizar o perfil de difusão é uma tarefa desafiadora. Os métodos demandam uma quantidade de memória razoavelmente maior que o DTI. Enquanto o DTI é codificado na memória com apenas seis elementos por \textit{voxel} (matriz 3x3 simétrica), métodos de alta ordem usam dezenas ou centenas de elementos. %Métodos de alta ordem não estabelecem um critério mínimo, entretanto é usual que centenas de elementos sejam utilizados para descreverem o perfil de difusão de forma razoável.

Renderização na GPU é uma forma para melhorar o desempenho. Porém, a implementação de um algoritmo de renderização de ODFs discretizadas em GPUs é algo desafiador pela grande quantidade de dados envolvidos. 
%necessários para sintetizar um glifo. 
Além disso, quando integrado ao \textit{pipeline} da renderização multimodal volumétrica baseada em \textit{ray-casting} de volumes de ressonância magnética de diversas modalidades, o algoritmo tem a sua margem de tempo de execução e espaço de memória diminuído.
%para manutenção da interatividade.


\section{Organização}
\label{sec:intro_organizacao}

O trabalho está organizado em cinco capítulos. No Capítulo \ref{chapter::metodos_hardi}, descreveremos brevemente as aquisições DWI, a motivação para utilização de tensores de alta ordem para modelar a difusão, detalharemos a implementação do método GQI, tanto no que diz respeito a sua formulação matemática, como a sua implementação computacional; no Capítulo \ref{chap::renderizacao_interativa_de_perfis_de_difusao} detalhamos o algoritmo interativo de renderização para glifos que representam as ODFs e mostramos como visualizá-los no ambiente multimodal VMTK-Neuro; no Capítulo \ref{sec::experimentos} apresentamos os experimentos que avaliam o desempenho temporal do algoritmo proposto e validam visualmente os glifos propostos em relação aos glifos superquádricos;
%algoritmo proposto em relação e a sua performance computacional integrada ao VMTK-Neuro, adicionalmente detalhamos de forma cronológica os recursos explorados para atingir a interatividade do algoritmo de renderização, bem como os ganhos proporcionados por cada um deles; 
e concluímos no Capítulo \ref{chap::conclusao} o trabalho e mencionamos oportunidades de trabalhos futuros.

%\chapter{Materiais e Métodos}

%\section{Materiais}






%\subsection{VMTK-Neuro}
%\label{ssec:vmtk-neuro}

%O VMTK-Neuro é um \textit{software} que renderiza em tempo real volumes de ressonância magnética (\textit{magnetic resonance imaging} - MRI) e possui ferramentas de exploração para volumes DWI a partir do DTI, conforme mostrado no fluxograma da figura \ref{fig::PipelineDTI_tracto}. O software utiliza a linguagem de programação em C++ e o OpenGL como API gráfica.

%\begin{figure}[ht]
%   \centering
%       \addtolength{\leftskip} {-2cm} % increase (absolute) value if needed
%    \addtolength{\rightskip}{-2cm}
%
%    %\vspace*{3mm}
%    \centering
%    \includegraphics[width=1.0\linewidth, angle=0]{figs/Fluxogramas/PipelineDTI_tracto.jpg}
%    \caption{Fluxograma para tractografia e glifos implementado no VMTK-Neuro.}
%    \label{fig::PipelineDTI_tracto}
%\end{figure}

%Estas ferramentas consistem na visualização em tempo interativo de tensores de difusão mapeados em glifos superquádricos \cite{Kindlmann2004} renderizados sobre as suas respectivas amostras (figura \ref{fig::intro_ex_DTI_glifos}), tractografia (figura \ref{fig::intro_ex_DTI_tractografia}) e o corregistro \cite{ting2014} de volumes de difusão com volumes anatômicos T1 .



%Na tractografia baseada em DTI, o VMTK-Neuro possui ferramentas de interatividade que possibilitam que o usuário possa inferir sobre as regiões do volume que contém os tratos a serem analisados, bem como filtrar fibras de interesse e eliminar fibras espúrias. Adicionalmente, parâmetros relacionados a reconstrução, que podem diferir de acordo com a região de análise do usuário, também são configuráveis. O algoritmo de tractografia apresenta resultados visuais em tempo interativo para as formas de interação mencionadas.


%\subsection{Volumes}

%%%%%VOLUMES UTILIZADOS NOS EXPERIMENTOS


%Temos a intenção de fazer a investigação com dados reais de pacientes do Hospital das Clínicas da UNICAMP, cujo uso foi aprovado pelo comitê de ética CAAE 0893.0.146-000.09, 


%No decorrer do trabalho tínhamos a intenção de usar o volumes do bancos de dados do Hospital das Clínicas da UNICAMP, porém os resultados preliminares em termos de conjuntos de ODFs obtidos não se mostraram adequados, e descartamos o uso. Fizemos um estudo para diagnosticar a natureza do problema, que está detalhado na subseção \ref{ssec::problema_overplus} do apêndice, e concluímos que está relacionado ao conjunto de gradientes de ponderação de difusão utilizado no padrão \textit{Overplus}.


%\section{Métodos}
%\subsection{Interatividade}

%Pela demanda de visualização interativa do VMTK-Neuro, objetivamos que a visualização dos perfis de difusão de glifos ODF para as amostras visíveis na tela aconteça em tempo interativo. Sendo assim, documentaremos os \textit{benchmarks} de ambos sistemas para atestar o cumprimento deste objetivo.

%\subsection{Tractografia}

%A motivação principal desde trabalho nasceu da seguinte pergunta: "como podemos melhorar a tractografia baseada em DTI do VMTK-Neuro?". Neste contexto, iremos comparar a tractografia baseada em DTI implementada no VMTK-Neuro e a tractografia baseada em HARDI em tratos que há a documentação de falhas do DTI e que são resolvidos pela abordagem que utiliza métodos HARDI.

%\todo[inline]{É melhor conversar com o Raphael sobre o uso das imagens da dissertação dele. \textcolor{green}{Falei e ele me autorizou}}


%\textcolor{red}{
\chapter{Imageamento de Difusão Intravóxel}
%\chapter{Imageamento de alta resolução angular para difusão}
\label{chapter::metodos_hardi}
%}

Neste capítulo trazemos a formulação do conceito de função de distribuição de orientações (\textit{orientation distribution function}, ODF), que é a base para as discussões do capítulo \ref{chap::renderizacao_interativa_de_perfis_de_difusao}, em que detalhamos um esquema de renderização para visualização dos perfis de difusão obtidos através de imageamento de ressonância magnética ponderadas em difusão (\textit{Diffusion Weighted Imaging}, DWI). Para que a dissertação seja auto-contida, faremos uma introdução às técnicas de aquisição DWI e aos métodos de síntese de orientações de difusão a partir dos sinais amostrados. Detalharemos o método de reconstrução GQI (\textit{Generalized Q-Sampling Imaging}) que aplicamos neste trabalho de Mestrado.

Na Seção \ref{sec::aquisicao_dwi}, faremos uma breve descrição da sequência de aquisição de um DWI, no que diz respeito às grandezas envolvidas e parâmetros associados, mas sem entrar nos detalhes da física do processo. Na Seção \ref{sec:sintese_intravoxels} são apresentadas duas diferentes alternativas para estimar as direções de difusão intravóxel  a partir dos sinais amostrados. Na Seção \ref{sec::dti_limitacoes_hardi}, trazemos uma descrição breve do DTI, suas limitações e a motivação do uso de métodos de mais alta ordem, na Seção \ref{metodos_de_alta_ordem} fazemos uma introdução aos métodos de alta ordem e na Seção \ref{sec::gqi}, descrevemos o método da amostragem generalizada no espaço-Q e uma técnica para definição de um domínio de direções espaciais \textit{quasi}-igualmente espaçadas requerido pelo GQI. E, finalmente, na Seção \ref{sec::vis_dODFs}, falamos sobre uma técnica de visualização das direções de difusão sintetizadas. %\sout{e adicionalmente, visando otimizar o uso de memória, exploramos a simetria do comportamento de difusão para diminuir a quantidade de amostras associadas ao domínio armazenadas.}

\section{Aquisição DWI}
\label{sec::aquisicao_dwi}
Nesta seção, faremos uma introdução às grandezas envolvidas na aquisição que usaremos para derivação do GQI na Seção \ref{sec::gqi} a partir de uma sequência de gradientes de ponderação de difusão bipolares \cite{mori2013}. Há diversas formas de se ponderar o sinal de MRI por difusão, dentre as quais a mais comumente utilizada é através da sequência de pulsos, denominada \textit{Pulsed Gradient Spin Echo} (PGSE), e é normalmente combinada à sequência \textit{Echo-Planar Imaging} (EPI) de aquisição de MRI. Uma introdução ao PGSE pode ser encontrada em \citeonline{DTI_Handbook}. Os fundamentos de imageamento por MRI e sequências de pulsos do EPI podem ser encontrados em \citeonline{liang2000}, e a física da difusão e seu imageamento via PGSE em \citeonline{tuch2002}.

Fig. \ref{fig::pgse_ilustrado} ilustra o processo de ponderação de um sinal MRI por difusão, no qual dois gradientes de ponderação de difusão de amplitude $G$ são aplicados em uma direção $\mathbf{\hat{q}}$ no eixo horizontal. Antes da aplicação do gradiente ($t_1$), os núcleos de hidrogênio têm seus respectivos \textit{spins} em fase, oscilando na mesma frequência, chamada de frequência de Larmour  após a excitação pelo pulso de radio-frequência \cite{mori2013}. Esta frequência é dada por  $f = \gamma \cdot B_0$, onde $\gamma$ é a razão giromagnética do núcleo de hidrogênio e $B_0$ é a magnitude do campo magnético estático principal que induz a precessão dos \textit{spins}. O sinal gerado, que é proporcional à soma vetorial do campo magnético gerado pelos \textit{spins}, é forte com frequência $f$.

\begin{figure}[ht]

%\subfigcapskip = -5pt
    \centering
    \includegraphics[width=.8\linewidth, angle=0]{figs/HARDI/pgse2.png}
    \caption{Medição de difusão das moléculas de água realizada na aquisições DWI nos escaneadores de MRI \\
    Fonte: \cite{voltoline2016}
    }
    \label{fig::pgse_ilustrado}
   \hspace{1pt}
\end{figure}

%\todo[inline]{Reformulação do parágrafo sobre a questão da projeção. E faça as devidas referências a Fig. 2.1. \textcolor{green}{OK! Adicionei outra figura que ilustra difusão paralela/ortogonal e difusão ocorrida.}}

Em $t_2$, o gradiente de intensidade $G$ é aplicado durante um intervalo de tempo $\delta$. O gradiente é um campo magnético que varia linearmente ao longo da direção $\mathbf{\hat{q}}$ e modifica a frequência de oscilação dos \textit{spins} do núcleo hidrogênio. Quando o gradiente cessa $(t_3)$, os núcleos voltam a ter a mesma frequência de oscilação do período $t_1$, mas com fases diferentes, levando a intensidade do sinal ser enfraquecida.

Depois de um intervalo de tempo $\Delta$ a partir do início da aplicação do primeiro gradiente, o processo de equalizar as fases é inicializado ($t_4$) utilizando um novo gradiente com mesma intensidade e duração, mas com sentido oposto em relação ao primeiro. Os núcleos pertencentes às moléculas que se difundiram na direção durante o intervalo de tempo $\Delta$, destacados em verde na janela de tempo $t_3$, terão suas fases corrigidas de forma a não ter a fase inicial novamente, pois estavam em lugares diferentes no espaço, consequentemente estando sob campos magnéticos diferentes nos instantes de defasagem e equalização de fase. Depois de um intervalo de refasagem, $\delta$, a intensidade do gradiente volta a ser balanceada em $t_5$.
O sinal resultante em $t_5$ é atenuado em relação ao sinal no intervalo $t_1$ (que está tracejado no instante $t_5$), devido à diferença de fase dos \textit{spins}. Consequentemente, diz-se que o sinal está ponderado em difusão.

Fig. \ref{fig::ilustracao_pgse_direcao} ilustra três casos no comportamento dos \textit{spins} durante o período da sequência para ponderação do sinal por difusão, no qual são ilustrados por três trios de \textit{spins}. A difusão do trio destacado em laranja no instante $t_1$ ocorrerão em paralelo a $\mathbf{\hat{q}}$, logo abaixo, os três \textit{spins} no círculo amarelo se difundirão de forma perpendicular a $\mathbf{\hat{q}}$ e mais abaixo ainda, os \textit{spins} circulados em azul não se difundirão. Pode-se observar que os \textit{spins} que se difundiram perpendicularmente a $\mathbf{\hat{q}}$ são submetidos aos mesmos campos magnéticos de ponderação de difusão dos spins que não se difundiram, o que faz a sua contribuição na atenuação do sinal ser nula \cite{mori2013}. Portanto, para uma caracterização precisa da mobilidade das moléculas em um ponto, é necessária a ponderação de difusão para diferentes direções.

\begin{figure}[ht]

%\subfigcapskip = -5pt
    \centering
    \includegraphics[width=.8\linewidth, angle=0]{figs/HARDI/ilustracao_limitacao.png}
    \caption{Defasagem e refasagem de \textit{spins} em direção paralela e ortogonal à direção do gradiente de difusão. A seta verde ilustra o deslocamento devido à difusão em $t_3$.
    }
    \label{fig::ilustracao_pgse_direcao}
   \hspace{1pt}
\end{figure}

%\sout{
%Em $t_3$, percebe-se a movimentação dos núcleos em direção perpendicular ao gradiente de difusão, ilustrado pelas moléculas no retângulo com contorno vermelho. A difusão que ocorre de forma perpendicular à $\mathbf{\hat{q}}$. Fig.   mostra que a atenuação do sinal gerada se deve à projeção da direção da difusão em $\mathbf{\hat{q}}$. \textcolor{red}{\sout{ e}} não afeta o sinal gerado em $t_5$, pois a refasagem restaura a mesma fase das moléculas que não se difundiram. \sout{Esta ilustração mostra que a atenuação do sinal gerada se deve à projeção da direção da difusão em $\mathbf{\hat{q}}$.} Assim, há a necessidade de gerar os sinais ponderados em difusão para outras direções para que a modelagem do processo possa ser mais precisa.
%}

A atenuação da ponderação por difusão pode ser configurada através da manipulação dos parâmetros de aquisição $G$, $\delta$ e $\Delta$ e é comum estas grandezas serem sintetizadas em um fator de ponderação de difusão chamado de valor $b$, que é usualmente expresso em $s/mm^2$. Sua formulação em função dos parâmetros de difusão é dada por \cite{lebihan1985}:

%\textcolor{green}{ defini como "um intervalo de tempo $\delta$"}

\begin{equation}
\label{eq::bvalue}
    b = \gamma^2G^2\delta^2(\Delta - \frac{\delta}{3}).
\end{equation}


%\todo[inline]{O que você afirma aqui difere do que está escrito no link. Dê uma comparada: \textcolor{green}{OK!}}
%\url{https://en.wikipedia.org/wiki/Diffusion_MRI#ADC_image} 

A respeito da atenuação gerada pelo gradiente de difusão, uma abordagem simplista \cite{descoteaux2015} para o cômputo em relação ao sinal não ponderado de difusão, é dado pela equação de Stejskal-Tanner \cite{stejskal1965}:

\begin{equation}
\label{eq::stanner}
    S(b) = S_0\exp{(-bD)} ,
\end{equation}
onde $S_0$ é o sinal sem ponderação de difusão, S(b) é o sinal de difusão atenuado, e $D$ é um escalar conhecido como o coeficiente de difusão aparente (\textit{Apparent Diffusion Coefficient}, ADC). Observe que o valor $b$, batizado desta forma 20 anos depois por \citeonline{lebihan1985}, abstrai em um coeficiente os parâmetros de difusão no cômputo da difusão aparente. A relação foi medida de forma empírica, e \citeonline{stejskal1965} almejavam descrever o decaimento do sinal devido a difusão em função dos parâmetros $G$, $\delta$, $\gamma$ e $\Delta$, e, a partir destes parâmetros, computar o coeficiente constante de difusão intrínseco a diferentes materiais.
A relação da Eq. \ref{eq::stanner} é válida para $D$ somente em difusão livre (Fig. \ref{fig::intro_difusao_isotropica}), pois para meios que apresentam obstáculos (Fig. \ref{fig::intro_difusao_anisotropica}), a mobilidade molecular não é a mesma para todas as direções \cite{douek1991}, sendo assim, o valor do ADC varia com a orientação $\mathbf{\hat{q}}$ do gradiente de ponderação de difusão aplicado.

Alguns trabalhos, como \citeonline{chenevert1990} e \citeonline{douek1991}, constaram que na substância branca do cérebro o sinal atenuado varia com a direção $\mathbf{\hat{q}}$, e que há correlação entre o maior decaimento do sinal em um sinal em que há um gradiente de ponderação de difusão paralelo a uma fibra e um menor decaimento do sinal quando perpendicular. A explicação plausível \cite{Basser1994} é que a difusão ocorria de forma livre ao longo da fibra, as membranas das células retardam a difusão na direção perpendicular. Assim, \citeonline{Basser1994} propuseram a extensão da Eq. \ref{eq::stanner} para sintetizar o decaimento do sinal de difusão em função da direção, no que é conhecido por imageamento por tensor de difusão (\textit{Diffusion Tensor Imaging}, DTI).


%\sout{, é necessária a sua extensão para um ADC$(\mathbf{\hat{q})$.}

%Nesta seção, introduzimos as grandezas que ponderam um sinal de ressonância magnética por difusão, e os apresentamos como uma sequência de pulsos de imageamento que promovem uma sequência de defasagem e refasagem, utilizando dois gradientes em sentidos opostos. Nesta sequência, há uma perca de sinal devido ao tempo de relaxação dos \textit{spins} no imageamento, que não dizem respeito à ponderação por difusão. \todo{É necessário explicar por quê estas outras sequências não são aplicadas se há mais vantagens ... Quais seriam as desvantagens?}\textcolor{magenta}{Há outras sequências, como o PGSE, que apresentam vantagens em relação à abordagem apresentada, que podem ser encontradas em \citeonline{mori2013}.}

Usualmente, as aquisições de difusão consistem em um conjunto de volumes ponderados por difusão, em que cada um tem um valor $b$ e uma direção de ponderação de difusão associado, além de pelo menos um volume sem ponderação por difusão. Nesta dissertação, usaremos o termo \textsf{volume} ~para referenciar uma imagem 3D composta por imagens 2D e o termo \textsf{fatia} para referenciar estas imagens 2D. Será usado também o termo \textsf{aquisição DWI} quando quisermos referenciar, de uma vez, o conjunto de volumes escaneados numa sessão de aquisição. Nós adotamos o termo \textsf{b0}  para referenciar volumes não-ponderados em difusão em uma aquisição DWI.

\section{Síntese de Direções Intravóxel}
\label{sec:sintese_intravoxels}

Nesta seção, abordaremos de forma introdutória os métodos de imageamento para modelagem de difusão. Na Seção \ref{sec::dti_limitacoes_hardi}, mencionamos brevemente o imageamento por tensor de difusão (\textit{diffusion tensor imaging}, DTI) e suas limitações, na Seção \ref{metodos_de_alta_ordem}, fazemos uma introdução aos métodos de alta ordem, nos quais categorizamos os métodos em técnicas de misturas e métodos livres de modelo dentre os quais, situamos o GQI; na Seção \ref{sec::gqi}, apresentamos o método GQI.

\subsection{DTI}
%\section{DTI e limitações}
\label{sec::dti_limitacoes_hardi}

\citeonline{Basser1994} propõem o imageamento por tensor de difusão (DTI), que visa modelar o decaimento do sinal de difusão em meios anisotrópicos a partir de um modelo Gaussiano, assumindo Eq. (\ref {eq::stanner}) o seguinte aspecto tensorial
\begin{equation}
\label{eq::dti_model}
    S(\mathbf{\hat{q}}, b) = S_0\exp{(-b~D(\mathbf{\hat{q}}))}, 
%\label{eq::dti_model}
%    S(\mathbf{\hat{g}}, b) = S_0\exp{(-b\mathbf{\hat{g}^T}\mathbf{D}\mathbf{\hat{g}})}, 
\end{equation}
onde o coeficiente de difusão aparente de difusão $D(\mathbf{\hat{q}})$ é modelado, no lugar de um escalar, por:
\begin{equation}
\label{eq::dti_model_adc}
    D(\mathbf{\hat{q}}) = \mathbf{\hat{q}^T}\mathbf{D}\mathbf{\hat{q}},
\end{equation} 
podendo o tensor de difusão $\mathbf{D}$ de ordem 2  ser representado por uma matriz 3x3 simétrica:

\begin{equation}
\label{eq::tensor}
\mathbf{D} = 
\begin{bmatrix}
D_{xx} & D_{xy} & D_{xz} \\ 
D_{xy} & D_{yy} & D_{yz} \\ 
D_{xz} & D_{yz} & D_{zz}  
\end{bmatrix}.
\end{equation}

%e o decaimento da difusão, derivado da Eq. \ref{eq::stanner}, se torna uma função dada por:

Observe que para cômputo do modelo, o DTI precisa de pelo menos seis volumes de difusão e um $b0$, para resolver o sistema de equações de seis incógnitas do tensor de difusão a partir do coeficiente de difusão aparente $D(\mathbf{\hat{q}})$ para um dado gradiente de ponderação de difusão de orientação $\mathbf{\hat{q}} = [q_x, q_y, q_z]^T$:
\begin{equation}
\label{eq::sistema_dti}
\frac{1}{b}\ln{\frac{S_0}{S(\mathbf{\hat{q}})}}=D_{x x} q_{x}^{2} +D_{y y} q_{y}^{2}+D_{z z} q_{z}^{2}+2 D_{x y} q_{x} q_{y} +2 D_{x z} q_{x} q_{z}+2 D_{y z} q_{y} q_{z} ,
\end{equation}
onde o termo à esquerda é o cômputo do coeficiente aparente de difusão para o sinal $S(\mathbf{\hat{q}})$ derivado da Eq. \ref{eq::stanner}, e à direita expandimos a operação mostrada na Eq. \ref{eq::dti_model_adc}. Na prática, as aquisições DTI tem entre 6 e 32 volumes ponderados por difusão e um volume b0 \cite{descoteaux2015}. 

A informação referente ao processo de difusão é extraída dos três autovetores e autovalores da matriz $\mathbf{D}$ (Eq. \ref{eq::tensor}), onde a direção da fibra é usualmente paralela a direção do autovetor associado ao maior autovalor.
Este modelo descreve bem regiões de fibras em que o comportamento de difusão ocorre predominantemente em uma direção. Em pontos que contém múltiplas fibras e que estão dispostas nas mais variadas configurações, como cruzamento, bifurcação, fusão, espalhamento e ``beijo'', o modelo Gaussiano não sintetiza de forma correta o comportamento da difusão, impedindo o cômputo das direções plausíveis para reconstrução de uma fibra de interesse \cite{fillard2011, daducci2014}. Há uma estimativa de que entre 66\% a 90\% da substância branca do cérebro contém múltiplas configurações de cruzamento de fibra \cite{descoteaux2015} e a limitação do DTI é um obstáculo para modelar as direções de fibras subjacentes de forma adequada dentro de um \textit{voxel}.

\subsection{Tensores de alta ordem}
\label{metodos_de_alta_ordem}

Devido às limitações dos tensores de segunda ordem (DTI) na resolução de cruzamento de fibras na substância branca do cérebro, houve uma agenda de pesquisa que começa no início da década de 2000 para distinguir múltiplas orientações numa amostra, e consequentemente houve uma demanda por mais amostras de sinais de difusão por \textit{voxel} nas aquisições DWI. %denominadas de imageamento difusão de alta resolução angular para difusão (HARDI - \textit{high angular resolution diffusion imaging}). Tipicamente aquisições HARDI \textit{single-shell} contém 45 volumes ponderados por e $1000 \leq b \leq 4500$ $s/mm^2$.
Há mais de cem artigos que propuseram métodos de imageamento para transformação do sinal de difusão para o seu perfil de densidade de probabilidade de direções de difusão de fibras entre 2000-2010 \cite{descoteaux2015}.

Os métodos consistem essencialmente na síntese do sinal de difusão em uma função de distribuição de orientações (ODF) que dão a possibilidade de inferir sobre a distribuição de fibras subjacentes em cada \textit{voxel}. Uma ODF consiste em uma associação entre um conjunto de direções, usualmente representadas por um vetor unitário $\mathbf{\hat{u}}$ (ou par $(\theta, \phi)$ em coordenadas esféricas), em um valor escalar $R(\mathbf{\hat{u}})$, representativo da probabilidade de difusividade em $\mathbf{\hat{u}}$. Em geral, esses métodos podem ser categorizados de duas formas de acordo com a natureza da técnica de transformada do sinal de difusão para a ODF: técnicas de misturas (\textit{mixture models techniques}) e técnicas livres de modelo, que abrange o GQI.

Em ambas categorias os métodos requerem uma quantidade maior de volumes ponderados por difusão, além de maiores valores $b$. Tipicamente, a quantidade de gradientes de ponderação por difusão é acima de 45, e $1000 \leq b \leq 4500s/mm^2$ \cite{descoteaux2015}. Comumente, aquisições DWI possuem um valor $b$ fixo para os volumes ponderados por difusão. Estas aquisições são chamadas de \textit{single-shell} porque suas amostras estão contidas em uma esfera no espaço-Q (Seção \ref{metodos_livres_de_modelo}). Aquisições \textit{single-shell} adequadas para tensores de alta ordem são chamadas de imageamento de difusão de alta resolução angular (\textit{High Angular Resolution Diffusion Imaging, HARDI}).

Em adição às aquisições HARDI \textit{single-shell}, há mais duas que valem mencionar: aquisições HARDI \textit{multi-shell}, no qual as aquisições são feitas para múltiplos valores $b$, tipicamente dois ou três, que são exemplificados no banco de dados do projeto \textit{Human Connectomme} \cite{essen2012} e a aquisição cartesiana no espaço-Q, que normalmente é associada ao método \textit{Diffusion Spectrum Imaging} e 
é considerada inviável clinicamente (Seção \ref{metodos_livres_de_modelo}). \citeonline{cheng2018} discutem aquisições \textit{single-shell} e \textit{multi-shell} HARDI.


\subsubsection{Técnicas de misturas}

Técnicas de misturas assumem que o sinal de difusão medido para um \textit{voxel} é a soma dos sinais gerados por cada população de fibra presente nele \cite{tournier2011}. Como exemplos, há a abordagem multi-tensor, também presente na tese de doutorado de \citeonline{tuch2002}, e a abordagem por deconvolução esférica, proposta originalmente por \citeonline{Tournier2004DirectEO}.

A abordagem multi-tensor modela a difusão como uma soma ponderada de modelos Gaussianos, com diferentes tensores associados a cada um. Enquanto na abordagem por deconvolução esférica, parte-se da premissa de que o sinal de difusão é gerado a partir da resposta da fibra ao gradiente de ponderação de difusão e este fenômeno é representado por uma convolução da função de distribuição de orientações de fibras (\textit{fiber orientation distribution function}, fODF) por uma função resposta para uma fibra única. Assim, a fODF é reconstruída a partir de uma técnica de deconvolução. O aplicativo MRTrix\footnote{Disponível em: \url{https://www.mrtrix.org/}} utiliza a abordagem \textit{constrained spherical deconvolution} \cite{tournier2007} para sintetizar sinais de difusão em fODFs.

\subsubsection{Métodos livres de modelo}
\label{metodos_livres_de_modelo}

Nos métodos livres de modelo, os sinais de difusão $W(\mathbf{r}, \mathbf{q})$ no \textit{voxel} $\mathbf{r}$ são amostrados no ponto do espaço-Q representado por\footnote{\citeonline{tuch2002} representa esta relação por $\mathbf{q} = (\gamma G \delta)\cdot \mathbf{\hat{q}}$} \cite{yeh2010}:

\begin{equation}
    \label{eq::ting}
    \mathbf{q} = \frac{\gamma G \delta}{2\pi} \cdot \mathbf{\hat{q}},
\end{equation}
onde $\mathbf{\hat{q}}$ é a direção do gradiente de ponderação de difusão, $\gamma$ é a razão giromagnética do núcleo de hidrogênio, $G$ e $\delta$ são parâmetros da sequência de pulsos (Fig. \ref{fig::pgse_ilustrado}). Substituindo a Eq. \ref{eq::bvalue} na Eq. \ref{eq::ting} e definindo $\lambda = \Delta - \delta/3$, chegamos a uma relação em que mostra a amostragem $\mathbf{q}$ como função dos valores $b$:

\begin{equation}
\label{eq::qspace_bvalue}
\mathbf{q} = \frac{1}{2\pi}\sqrt{\frac{b}{\lambda}} \mathbf{\hat{q}}.
\end{equation}

Definindo a probabilidade de deslocamento $\mathbf{u}$ durante um dado tempo de difusão $\Delta$ como propagador de difusão (\textit{ensemble-average diffusion propagator}) $\bar{p}_{\Delta}(\mathbf{r}, \mathbf{u})$, \citeonline{tuch2002} mostrou que os sinais de difusão aplicados neste intervalo de tempo, $W_{\Delta}(\mathbf{r}, \mathbf{q})$, guardam com o propagador de difusão a seguinte relação de Fourier 
%está ilustrada na Eq. \ref{eq::propagator}.

%O propagador de difusão $p(\mathbf{r}, \mathbf{u})$ é uma função que gera a probabilidade de deslocamento $\mathbf{u}$ durante um tempo de difusão $t$:

%\todo[inline]{Explique o operador $\mathfrak{F}^{-1}$.}
\begin{equation}
\label{eq::propagator}
    \bar{p}_{\Delta}(\mathbf{r}, \mathbf{u}) =\frac{1}{W_{\Delta}(\mathbf{r},\mathbf{0}) } \int W_{\Delta}(\mathbf{r},\mathbf{q}) e^{-i2 \pi \mathbf{q} \cdot \mathbf{u}} d \mathbf{q} ,
\end{equation}
onde $W_{\Delta}(\mathbf{r},\mathbf{0})$ é o sinal no espaço-Q obtido na ausência de gradiente de ponderação de difusão, e que $\bar{p}_{\Delta}(\mathbf{r}, \mathbf{u})$ é uma função de densidade de probabilidade.

A partir da Eq. \ref{eq::propagator}, métodos de imageamento, como o \textit{Diffusion Spectrum Imaging} (DSI) \cite{tuch2002, wedeen2005}, \textit{Q-Ball Imaging} \cite{TuchQBall2004} e GQI \cite{yeh2010}, foram desenvolvidos para inferir sobre o perfil de difusão, ou a distribuição de probabilidade direcional de fibras \textit{voxel} a \textit{voxel}. 
A função de distribuição de orientações de difusão (\textit{Diffusion Orientation Distribution Function}, dODF) $\Psi(\mathbf{\hat{u}})$ para a direção $\mathbf{\hat{u}}$, onde $|\mathbf{\hat{u}}| = 1$,  nos permite sintetizar a distribuição de fibras subjacentes. Sua relação com o propagador de difusão é dada por \cite{tuch2002}
\begin{equation}
\label{eq::dodf_propagador}
\Psi(\mathbf{\mathbf{r},\hat{u}})=\int_{0}^{\infty} \bar{p}_{\Delta}(\mathbf{r}, \rho  \mathbf{\hat{u}}) \rho^2 \mathrm{~d}\rho .
\end{equation}

%, fazendo uso da relação de Fourier entre o $W_{\Delta}(\mathbf{r}, \mathbf{q})$ e o propagador de difusão $\bar{p}_{\Delta}(\mathbf{r}, \mathbf{u})$, onde $\Delta$ é constante e corresponde à duração de difusão (Fig. \ref{fig::pgse_ilustrado}). O propagador de difusão é uma função que gera a probabilidade de deslocamento $\mathbf{u}$ durante o tempo de difusão \sout{t =} $\Delta$. A relação entre ambas pode ser expressa pela equação \cite{tuch2002}
%está ilustrada na Eq. \ref{eq::propagator}.

%O propagador de difusão $p(\mathbf{r}, \mathbf{u})$ é uma função que gera a probabilidade de deslocamento $\mathbf{u}$ durante um tempo de difusão $t$:

%\todo[inline]{Explique o operador $\mathfrak{F}^{-1}$.}
%\begin{equation}
%\label{eq::propagator}
%    \bar{p}_{\Delta}(\mathbf{r}, \mathbf{u}) =\frac{1}{W_{\Delta}(\mathbf{r},\mathbf{0}) } \int W_{\Delta}(\mathbf{r},\mathbf{q}) e^{-i2 \pi \mathbf{q} \cdot \mathbf{u}} d \mathbf{q} ,
%\end{equation}
%onde $W_{\Delta}(\mathbf{r},\mathbf{0})$ \todo{Como assim certificar?}certifica que $\bar{p}_{\Delta}(\mathbf{r}, \mathbf{u})$ é uma função de densidade de probabilidade.

% \begin{equation}
% \int_{\mathbf{q} \in Q} W(\mathbf{q}, t) \exp (i2 \pi \mathbf{q} \cdot \mathbf{u}) d \mathbf{q}
% \end{equation}


%\todo[inline]{Sugiro que insira no parágrafo abaixo o que conversamos: DSI faz aquisições diretas do espectro médio dos deslocamento de \textit{spins} amostrados em intervalos regulares de direções $\mathbf{u}$ e de ponderações em difusão $b$ no espaço-Q,  e faz uso das Eqs. \ref{eq::qspace_bvalue} e \ref{eq::dodf_propagador} para recuperar (diretamente) os sinais no espaço $R^3$ via transformadas inversas de Fourier. Requer multiplos valores b e múltiplos gradientes. E dar uma ideia em que consistem as aquisições menos demandantes, porém equivalentes, entre as quais estão GQI que você vai detalhar na próxima seção. \textcolor{green}{Feito}}

O DSI \cite{wedeen2005} faz o mapeamento mostrado nas Eq. \ref{eq::propagator} e \ref{eq::dodf_propagador}. A amostragem para este método é em pontos uniformemente espaçados no espaço-Q. Necessita de muitos volumes ponderados por difusão (515 volumes \cite{wedeen2005}) e gradientes de ponderação de difusão fortes ($0 \leq b \leq 17000 s/mm^2$) para o cômputo da transformada discreta de Fourier. Devido a isto, outros métodos surgem com o objetivo derivar dODFs demandando menos amostras no espaço-Q que o DSI.
%\todo{O que você quis dizer como volumes adequados para aquisições HARDI?}
O \textit{Q-Ball Imaging} é o primeiro deles, através do qual \citeonline{TuchQBall2004} mostra que em uma aquisição HARDI \textit{single shell}, ou seja, usando amostras sobre uma superfície esférica no espaço-Q, é possível obter uma versão suavizada da dODF do DSI aplicando a transformada de Funk-Radon sobre os sinais de difusão. O GQI \cite{yeh2010}, por sua vez, relaciona os sinais de difusão com a distribuição quantitativa dos \textit{spins} deslocados por difusão, ao invés dos deslocamentos de difusão.

%O \textit{Q-Ball Imaging} \cite{TuchQBall2004} é um destes métodos e o primeiro a ser proposto após o DSI. \citeonline{TuchQBall2004} prova que a uma versão suavizada da dODF pode ser computada através da Transformada de Funk-Radon aplicada em uma esfera no espaço-Q. Este método é implementado na biblioteca FSL\footnote{Disponível em: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FSL}.

Neste trabalho, escolhemos o método de modelo livre GQI para reconstruir ODFs a partir das aquisições de alta resolução angular em difusão pelas seguintes características do método \cite{yeh2010}:

\begin{enumerate}
    \item ser aplicável em categorias de aquisição com múltiplos valores $b$,
    \item bom desempenho em volumes de mais baixa resolução angular, e
    \item ter parâmetros de regularização e filtragem integrados ao método, o que é necessário para o cômputo das informações direcionais das fibras subjacentes.
\end{enumerate}

%Há \todo{Desvantagem em relação a quais métodos? Como são representados os dados nos outroa métodos? Não são como amostras? \textcolor{green}{OK!}}
%\sout{Uma desvantagem na representação em memória do GQI em relação a métodos de alta ordem que caracterizam as ODFs como uma soma ponderada de funções base, como a formulação analítica do \textit{Q-Ball Imaging} \cite{descoteaux2007_QBI} e as abordagens de deconvolução esférica \cite{Tournier2004DirectEO, tournier2007}. Enquanto no GQI, o uso de memória relacionado ao método consiste em amostras das funções computadas, o uso de memória dos métodos que formulam as ODFs analiticamente é referente a coeficientes de funções base, que usualmente ocupam menos espaço.}

%\todo{escolha de quê? de um modelo de síntese de ODFs. \textcolor{green}{OK!}}
Um ponto importante no processo de escolha do método de alta ordem é referente à adequabilidade em tractografia. No seu trabalho sobre comparações de diferentes métodos de imageamento em tractografia, \citeonline{daducci2014} concluíram que não há métodos que se sobressaem em relação a outros nas mais diferentes condições experimentais.

Há diferentes aplicativos livres, ligados a grupos de pesquisa, que processam DWIs com métodos livres de modelo. Há o DSI-Studio\footnote{Disponível em: \url{http://dsi-studio.labsolver.org}}, que utiliza o GQI; há também o aplicativo/biblioteca FSL\footnote{Disponível em: \url{https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FSL}} e o aplicativo Fibernavigator\footnote{Disponível em: \url{https://scilus.github.io/fibernavigator/}}, em que ambos utilizam o \textit{Q-Ball Imaging}.



%O DSI \cite{wedeen2005} - proposto originalmente em 2000 - explora e sintetiza uma função de orientação de orientação de através da relação de Fourier entre o sinal de difusão no espaço-Q e a aquisição




%consiste em um mapeamento das amostras de difusão em um ponto contido em uma aquisição DWI em um modelo gaussiano, que é sintetizada por tensor de ordem 2, representado por uma matriz 3x3 simétrica (Eq. \ref{eq::tensor}). Para seu cômputo, o DTI necessita de no mínimo seis volumes ponderados por difusão em adição a um $b0$, nos quais geram um sistema para cômputo dos seis coeficientes do tensor. Na prática, os volumes DWI escaneados para serem usados com este método, que é predominante no uso clínico, varia entre 6 e 32 \cite{descoteaux2015}.




%Entretanto, o método apresenta limitações \textcolor{red}{como já destacado na seção \ref{sec:introducao}.}



%e o termo \textsf{resolução angular} \sout{com} \textcolor{red}{à} quantidade de volumes ponderados por difusão em uma aquisição DWI. 

%\todo[inline]{DTI assume que a função densidade de probabilidade é Gaussiana enquanto a representação no espaço q (Q-space imaging) não faz nenhuma suposição quanto a um modelo para a função densidade de probabilidade. As funções de difusão no espaço Q são adquiridas diretamente através da amostragem dos sinais de difusão num reticulado cartesiano 3D. Amostragens sobre calotas esféricas (\textit{spherical shell}) são conhecidas como HARDI. É mostrado que HARDI pode ser transformado em Q-ball imaging, também sem condicionamento a um modelo. Veja \cite{TuchQBall2004}. As explicações que se seguem estão confusas. Parece que você colocou num pacote QSI e HARDI/QBI.}



% \textcolor{magenta}{
% A respeito dos valores $b$ utilizados em uma aquisição DWI, e como utilizá-los no espaço-Q, há normalmente três estratégias de amostragens para a aquisição:
% \begin{enumerate}
%     \item amostragem cartesiana, onde as amostras são igualmente espaçadas no espaço-Q em um espaço cartesiano tridimensional e que é usualmente associado ao imageamento de espectro por difusão (DSI) \cite{wedeen2005};
%     \item amostragem \textit{single-shell}, que consiste na amostragem feita para um valor b constante, que está contido numa esfera no espaço-Q;
%     \item amostragem \textit{multi-shell}, que consiste na amostragem que consiste em diferentes conjuntos de pontos contidos em mais de uma esfera, que se referem a uma quantidade no espaço-Q.
% \end{enumerate}
% }



%!! ILUSTRAR SINGLESHELL- MULTISHELL  e CARTESIANA!!

%Dado um conjunto de amostras de sinais de difusão no espaço-Q, há diversas técnicas para descrever o processo de difusão \textit{voxel} a \textit{voxel} sumarizá-los em potenciais caminhos de fibras, sendo o DTI \cite{Basser1994} a mais utilizada.


%\section{DTI, limitações e HARDI}
%\section{Estimativa de Orientações de Difusão}
%\label{sec::dti_limitacoes_hardi}
%\todo[inline]{Sugiro que façs aqui uma espécie de survey dos métodos ... Fica a seu critério a classificação ... pode ser por forma de amostragem como em \url{https://www.researchgate.net/publication/319558026_High_Angular_Resolution_Diffusion_Imaging_HARDI/link/59e88db8a6fdccfe7f8e8a4f/download} ... Sugiro que poderia fazer um merge com capítulo 3.}

%Na aquisição do DWI, é escaneado um conjunto de volumes em que cada um possui a ponderação de único gradiente de difusão associado a um valor-b\footnote{O valor-b é uma métrica de sensitividade para difusão e é função de parâmetros da aquisição do DWI, como função da intensidade, duração e o intervalo de tempo dos gradientes de ponderação de difusão. Quanto maior o seu valor, maior o decaimento do sinal relativo à difusão.}, e, adicionalmente, um ou mais volumes sem ponderação de gradiente, denominado volume b0. A quantidade de volumes ponderados para diferentes direções de gradiente é denominada de resolução angular. Técnicas para sumarizar os sinais coletados em informações de potenciais caminhos de fibras nervosas são objeto de pesquisa desde o início dos anos 90 \cite{descoteaux2015}.



%\sout{A limitação do DTI acerca da possibilidade de inferir sobre fibras subjacentes é vinculada a modelagem da difusão ao modelo Gaussiano. O modelo descreve bem regiões de fibras em que o comportamento de difusão ocorre predominantemente em uma direção. Em pontos que contém múltiplas fibras e que estão dispostas nas mais variadas configurações (por exemplo: cruzamento, bifurcação, mistura, "beijo") o modelo gaussiano não sintetiza de forma correta o comportamento da difusão, impedindo o cômputo das direções plausíveis para reconstrução de uma fibra de interesse \cite{fillard2011, daducci2014}. Há um estimativa que entre 66\% a 90\% da substância branca do cérebro contém múltiplas configurações de cruzamento de fibra \cite{descoteaux2015} e a limitação do DTI é um obstáculo para modelar as direções de fibras subjacentes de forma adequada.}

%\todo[inline]{Não há Q-space imaging como uma proposta alternativa para DTI?}





%As técnicas livres de modelo buscam \sout{formular} uma \sout{representação para} formulação da \sout{função de} difusão \textcolor{red}{em função do seu perfil angular $R(\mathbf{\hat{u}})$,} explorando a relação de Fourier \cite{tuch2002} do sinal de difusão $W(\mathbf{r}, \mathbf{q})$\sout{ para obtenção de características da difusão em seu perfil angular $R(\mathbf{\hat{u}})$}. Entre os métodos \sout{foram} propostos, \textcolor{red}{destacam-se} o DSI \textcolor{red}{(\textit{Diffusion Sampling Imaging})} \cite{wedeen2005}, proposto originalmente em 2000 e presente na tese de doutorado de \citeonline{tuch2002}, juntamente com o QBI \textcolor{red}{(\textit{Q-ball Imaging})}, proposto em \citeonline{TuchQBall2004} \sout{em sua forma de artigo}, e o GQI \textcolor{red}{(\textit{Generalized Q-sampling Imaging})} \cite{yeh2010}\sout{ exemplificam esta categoria de métodos}.


%!!Porque geram ODFs?

%Estes métodos geram uma ODF a partir do sinal de difusão. Geralmente ODFs não possui a restrição quanto a regressão uma função tridimensional que o DTI possui e portanto conseguem ser mais descritivos do processo de difusão e gerar boas aproximações das fibras subjacentes, especialmente em cruzamentos \cite{daducci2014}.

% e evidentemente precisamos fazer uma seleção dos quais deles são mais relevantes para o nosso trabalho.






%A grande desvantagem do GQI implementado na forma proposta por \citeonline{yeh2010} ocorre no uso de memória. A codificação de ODFs é feita por amostras e requer uma grande quantidade de memória, usualmente nas centenas de números por \textit{voxel}. Métodos que armazenam os dados como coeficientes de função base, como o QBI formulado por \citeonline{descoteaux2007_QBI} e o CSD \cite{tournier2007} tendem a utilizar menos memória.

\subsection{Amostragem Generalizada no Espaço Q}
\label{sec::gqi}

Nesta seção faremos uma breve apresentação do método GQI (\textit{Generalized Q-sampling Imaging}), a sua fundamentação teórica, na qual mostraremos a relação entre o sinal de difusão $W(\mathbf{r},\mathbf{q})$ e a função de distribuição de \textit{spins} (\textit{spin distribution function}, SDF) por uma multiplicação matricial. Mostraremos uma formulação discreta de SDFs e a sua relação linear com dODFs. Ambas diferem 
por um fator de normalização. Uma boa aproximação da versão discreta de SDFs à versão contínua é usualmente feita a partir de uma amostragem de direções 3D com uma certa uniformidade no domínio esférico. Subdivisões do icosaedro são frequentemente utilizados para definir esse domínio \cite{tuch2002, TuchQBall2004, descoteaux2007, yeh2010}. Discutiremos, adicionalmente, uma técnica de subdivisões.

%o método de reconstrução de funções de densidade de probabilidade de difusão em relação às diferentes orientações que usaremos para reconstruir ODF (\textit{Orientation Distribution Function}).

\subsubsection{Formulação}
\label{ssec::gqi_formulacao}

O GQI é um método livre de modelo, derivado da relação de Fourier entre o sinal de difusão $W(\mathbf{r},\mathbf{q})$ no \textit{voxel}, de coordenadas $\mathbf{r}$ no espaço-Q, e o deslocamento dos \textit{spins} devido à difusão, modelado pela função de distribuição de \textit{spins} (\textit{Spin Distribution Function}, SDF) $\psi_Q(\mathbf{r}, \mathbf{\hat{u}})$, onde a orientação $\mathbf{\hat{u}}$ representa a direção dos \textit{spins} submetidos ao processo de difusão. % \todo{Conteúdo angular ou orientação/direção de spin?}\textcolor{magenta}{o conteúdo angular da SDF}.

Para isso, o método explora a relação de Fourier em três dimensões entre o sinal de difusão $W(\mathbf{r}, \mathbf{q})$ e a função de densidade de \textit{spins} $Q(\mathbf{r}, \mathbf{u})$
\begin{equation}
\label{eq::spin_densidade_presentacao}
    Q(\mathbf{r}, \mathbf{u}) = W_{\Delta}(\mathbf{r}, \mathbf{0}) \bar{p}_{\Delta}(\mathbf{r}, \mathbf{u}),
\end{equation}
onde $W_{\Delta}(\mathbf{r}, \mathbf{0})$ é o valor da densidade de \textit{spins}. Multiplicando a Eq. \ref{eq::propagator} por  $W_{\Delta}(\mathbf{r}, \mathbf{0})$ e substituindo a expressão à esquerda por $Q(\mathbf{r}, \mathbf{u})$, temos:


\begin{equation}
\label{eq::spin_diffsignal_1}
    Q(\mathbf{r}, \mathbf{u}) =
    \int \! W(\mathbf{r}, \mathbf{q})e^{-i2\pi \mathbf{q}\cdot \mathbf{u} } \,\mathrm{d}\mathbf{q} .
\end{equation}

Como $Q(\mathbf{r}, \mathbf{u})$ é real e $W(\mathbf{r}, \mathbf{q})$ é simétrica, podemos considerar somente a parte real da transformada, reduzindo a expressão em:

\begin{equation}
\label{eq::spin_diffsignal_2}
    Q(\mathbf{r}, \mathbf{u}) =
     \int \! W(\mathbf{r}, \mathbf{q})\text{cos}(2\pi \mathbf{q}\cdot \mathbf{u}) \,\mathrm{d}\mathbf{q} .
\end{equation}

Por outro lado, podemos estimar a quantidade de \textit{spins} que se submetem a difusão em uma direção $\mathbf{\hat{u}}$ (|$\mathbf{\hat{u}}$| = 1) através da integração da função $Q(\mathbf{r}, \mathbf{u})$ nesta direção, o que resulta em:
\begin{equation}
\label{eq::sdf_spin}
    \psi_Q(\mathbf{r}, \mathbf{\hat{u}}) =
   \int_{0}^{L_{\Delta}} Q(\mathbf{r}, L\mathbf{\hat{u}})\!  \,\mathrm{d}L , 
\end{equation}
onde $L_\Delta$ é a distância de difusão na direção  $\mathbf{r}$.

Combinando as Eq. \ref{eq::spin_diffsignal_2} e \ref{eq::sdf_spin}, obtemos a relação entre os sinais de difusão $W(\mathbf{r}, \mathbf{q})$ e $\psi_Q(\mathbf{r}, \mathbf{\hat{u}})$:
\begin{equation}
\label{eq::sdf_continuous_1}
    \psi_Q(\mathbf{r}, \mathbf{\hat{u}}) =
    \int_{0}^{L_{\Delta}}\int \! W(\mathbf{r}, \mathbf{q}) \text{cos}(2\pi L_{\Delta} \mathbf{q} \cdot \mathbf{\hat{u}}) \,\mathrm{d}\mathbf{q} \mathrm{d}L .
\end{equation}

Integrando em $L$, obtemos $\psi_Q(\mathbf{r}, \mathbf{\hat{u}})$ em função do sinal de difusão: 
\begin{equation}
\label{eq::sdf_continuous_2}
    \psi_Q(\mathbf{r}, \mathbf{\hat{u}}) =
    L_{\Delta} \int \! W(\mathbf{r}, \mathbf{q}) \text{sinc}(2\pi L_{\Delta} \mathbf{q} \cdot \mathbf{\hat{u}}) \,\mathrm{d}\mathbf{q} ,
\end{equation}
onde $\text{sinc}(x) = \text{sin}(x)/x$ para todo $x$ real, exceto $0$ e $\text{sinc}(0) = 1$.

Assumindo que a área de quadratura seja constante $A_q$ na discretização da Eq. \ref{eq::sdf_continuous_2}, chegamos na forma discreta de SDF que, em notação, diferenciamos da sua forma contínua $\psi_Q(\mathbf{r}, \mathbf{\hat{u}})$ mudando o índice $Q$ por $m$:


\begin{equation}
\label{eq::sdf_discrete_1}
    \psi_m(\mathbf{r}, \mathbf{\hat{u}}) =
     A_qL_{\Delta}\sum_{\mathbf{q} \in \mathbf{Q}} W(\mathbf{r}, \mathbf{q})\text{sinc}(2\pi L_{\Delta} \mathbf{q}\cdot\mathbf{\hat{u}}),
\end{equation}
onde $\mathbf{Q}= [
\mathbf{q}_1,
\mathbf{q}_2,
\mathbf{q}_3, ...,
\mathbf{q}_T
]$ corresponde às $T$ amostras no espaço-Q.

Observe que a distância de difusão ajusta a contribuição de cada $W(\mathbf{r}, \mathbf{q})$ no cômputo de $\psi_m(\mathbf{r}, \mathbf{\hat{u}})$ e funciona como um parâmetro de regularização. Se $L_{\Delta}$ tende a infinito, a função de distribuição irá se comportar como um impulso na origem, gerando um $\psi_m(\mathbf{r}, \mathbf{\hat{u}})$ fortemente ponderado pelas direções de $\mathbf{q}$ ortogonais a $\mathbf{\hat{u}}$. Um $L_{\Delta}$ pequeno implica em uma maior ponderação para coeficientes que não são ortogonais a $\mathbf{\hat{u}}$, o que atua como uma filtragem. No caso extremo, $L_{\Delta} = 0$, implica que todos os pesos aplicados para cômputo de ODFs em todas as direções $\mathbf{\hat{u}}$ se tornem iguais.

Considerando que a distribuição da difusão seja Gaussiana, a distância de difusão é dada por $L_{\Delta}=(6D\lambda)^{1/2}$, onde $D$ é o coeficiente de difusão da água na temperatura do corpo e $\lambda = \Delta - \delta/3$, que correspondem aos parâmetros de aquisição mostrados em Fig. \ref{fig::pgse_ilustrado}. 
Tipicamente, assume-se $D = 3.0*10^{-3} mm^2/s$ \cite{yeh2019_DSI}. Podemos ponderar $L_{\Delta}$ por um fator $\sigma$, isto é, $L_{\Delta} = \sigma(6D\lambda)^{1/2}$. Para $\sigma$ = 1.3, $80\%$ da difusão é considerada no cômputo da $\psi_Q(\mathbf{r}, \mathbf{\hat{u}})$.

Substituindo $L_{\Delta}$ por $\sigma(6D\lambda)^{1/2}$ e $\mathbf{q}$ pela Eq. \ref{eq::qspace_bvalue}, obtemos:


%Uma SDF é formada pela soma de várias SDF bases oferecidos por um esquema de amostragem. A relação entre o sinal de difusão é dada pela expressão:

\begin{equation}
\label{eq::sdf_discrete_2}
    \psi_m(\mathbf{r}, \mathbf{\hat{u}}) =
    A_qL_{\Delta}\sum_{\mathbf{q} \in \mathbf{Q}}W(\mathbf{r}, \mathbf{q})\text{sinc}(\sigma \sqrt{6D\cdot b(\mathbf{q})}\,\,  \mathbf{\hat{q}}\cdot\mathbf{\hat{u}}) .
\end{equation}

 Na prática, as informações de ponderação de difusão em cada volume na aquisição DWI estão associadas a um valor $b(\mathbf{q})$ e uma direção associada ao gradiente de ponderação de difusão $\mathbf{\hat{q}}$.% Vale a pena ressaltar que aquisições cujos sinais DWI são amostrados na metade de uma esfera para gradientes na direção $\mathbf{\hat{q}}$ tem um simétrico,  $-\mathbf{\hat{q}}$ associado no espaço-Q, tal que o valor de sinal de difusão $W(\mathbf{r}, -\mathbf{q}) = W(\mathbf{r}, \mathbf{q})$ \cite{descoteaux2015}.

A estimativa da SDF por \textit{voxel}, 
$\boldsymbol{\psi}_m(\mathbf{r}) = [
\psi_m(\mathbf{r}, \mathbf{\hat{u}}_1), 
\psi_m(\mathbf{r}, \mathbf{\hat{u}}_2), 
\psi_m(\mathbf{r}, \mathbf{\hat{u}}_3),$
$ ..., 
\psi_m(\mathbf{r}, \mathbf{\hat{u}}_S)
]^T$
é feita por meio de $S$ amostras, nas quais são reconstruídas num domínio de $S$ direções de interesse $\mathbf{U} = [
\mathbf{\hat{u}}_1, 
\mathbf{\hat{u}}_2, 
\mathbf{\hat{u}}_3, \dots, 
\mathbf{\hat{u}}_S 
]$, a partir de sinais de um conjunto de difusão $\mathbf{W}(\mathbf{r}) = [
W(\mathbf{r},\mathbf{q}_1),
W(\mathbf{r},\mathbf{q}_2),
W(\mathbf{r},\mathbf{q}_3), \dots ,
W(\mathbf{r},\mathbf{q}_T)
]^T$. Detalharemos o processo de escolha de $\mathbf{U}$ na Seção \ref{ssec::dominio_esferico}.

Assim, definimos a relação entre $\boldsymbol{\psi}_m(\mathbf{r})$ em função de $\mathbf{W}(\mathbf{r})$ através de uma multiplicação matricial definida pela matriz $\mathbf{S}_{S\times T}$:
\begin{equation}
\label{eq::gqi_vec}
    \boldsymbol{\psi}_m(\mathbf{r}) = \mathbf{S}*\mathbf{W}(\mathbf{r}) ,
\end{equation}
onde cada elemento $s_{i,j} \in \mathbf{S}$ é dado por
\begin{equation}
\label{eq::s_ij}
s_{i,j} = A_qL_{\Delta}\text{sinc}(\sigma \sqrt{6D.b(\mathbf{q}_j)} )\mathbf{\hat{q}}_j.\mathbf{\hat{u}_i}) .
\end{equation}

A partir de $\boldsymbol{\psi}_m(\mathbf{r})$, obtemos as dODFs $\boldsymbol{\psi}(\mathbf{r})$ fazendo a normalização pela soma dos valores de SDF em cada \textit{voxel} obtendo assim uma função de densidade de probabilidade \cite{yeh2010}:
\begin{equation}
\label{eq::SDF2dODF_prob}
    \boldsymbol{\psi}(\mathbf{r}, \mathbf{\hat{u}}) =
    \frac{\boldsymbol{\psi}_m(\mathbf{r}, \mathbf{\hat{u}})}{\sum \limits_{\mathbf{\hat{u}} \in \mathbf{U}}\boldsymbol{\psi}_m(\mathbf{r}, \mathbf{\hat{u}})}.
\end{equation}
Observe que a normalização cancela o fator de escala $A_qL_{\Delta}$ da Eq. \ref{eq::sdf_discrete_1}.


%O próximo passo é transformação de $\boldsymbol{\psi}_m(\mathbf{r})$ em ODF, somando seus valores e dividindo cada elemento pela soma dos vetores. Observe que esta operação, aproxima $\boldsymbol{\psi}_m(\mathbf{r})$ de uma dODF, visto a formulação do GQI sem o fator de escala $W_{\Delta}(\mathbf{r}, \mathbf{0})$, poderia ser 

%Observe que a diferença entre e a dODF $\Psi(\mathbf{r}, \mathbf{\hat{u}})$ é o escalonamento pelo fator , e a normalização pela soma cancela este fator.

%\begin{equation}
%\label{eq::s_ij}
%s_{i,j} = A_qL_{\Delta}\text{sinc}(\sigma \sqrt{6D.b(\mathbf{q}_j)} )\mathbf{\hat{q}}_j.\mathbf{\hat{u}_i}) ,
%\end{equation}

%\sout{Com o objetivo de enfatizar as direções dominantes de difusão na renderização de glifos, \citeonline{TuchQBall2004} sugere normalizar cada função de distribuição de \textit{spins} $\boldsymbol{\psi}_m(\mathbf{r})$ pela normalização min-max, \textcolor{red}{cujo resultado Sicrano \cite{???} mostrou que é uma} ODF $\boldsymbol{R}(\mathbf{r})$\sout{, conforme mostrado na Eq. \ref{eq::SDF2dODF}.} }

% \begin{equation}
% \label{eq::SDF2dODF}
%     \boldsymbol{R}(\mathbf{r}) = [ \frac{\boldsymbol{\psi}_m(\mathbf{r}) - \text{min}(\boldsymbol{\psi}_m(\mathbf{r}))}{\text{max}(\boldsymbol{\psi}_m(\mathbf{r})) - \text{min}(\boldsymbol{\psi}_m(\mathbf{r}))}], m = 1, \cdots, S ,
% \end{equation}
% \sout{onde $\text{min}(\boldsymbol{\psi}_m(\mathbf{r}))$ e $\text{max}(\boldsymbol{\psi}_m(\mathbf{r}))$ são, respectivamente, o mínimo e o máximo dos $S$ valores associados à amostra $\mathbf{r}$.}

%\sout{O efeito da normalização está ilustrado na Fig. \ref{fig::normalizacao_min_max}. Observe que a normalização cancela o fator de escala $A_qL_{\Delta}$ da Eq. \ref{eq::s_ij}.}

%\begin{equation}
%\label{eq::SDF2dODF}
%    \boldsymbol{R}(\mathbf{r}) = [ \frac{\boldsymbol{\psi}_m(\mathbf{r}) - %\text{min}(\boldsymbol{\psi}_m(\mathbf{r}))}{\text{max}(\boldsymbol{\psi}_m(\mathbf{r})) - %\text{min}(\boldsymbol{\psi}_m(\mathbf{r}))}], m = 1, \cdots, S
%\end{equation}

%\begin{figure}[ht]
%\centering
%\captionsetup[subfloat]{farskip=0pt,nearskip=0pt}
%\centering
    %\subfloat[ODF não normalizada] {\includegraphics[width=.30\linewidth, angle=0]{figs/HARDI/ODF_normalizacao/ODF-pura.png}
    %\label{fig::odf_pura}
    %}
    %\hspace{1em}
    %\subfloat[ODF min-max normalizada] {\includegraphics[width=.17\linewidth, angle=0]{figs/HARDI/ODF_normalizacao/ODF_minmax.png}
    %\label{fig::odf_minmax}
    %}
     %\caption{Glifo ODF da mesma ODF com e sem a normalização min-max. A disposição de cores glifo enfatiza a orientação da ODF, no qual a direção dos eixos x, y, z estão mapeadas nas cores vermelha, verde e azul. Note que em \ref{fig::odf_minmax}, a estrutura orientacional da ODF é enfatizada com uma forte componente na direção do eixo y. O Capítulo \ref{chap::renderizacao_interativa_de_perfis_de_difusao} traz a formulação com detalhes do glifo.}
    %\label{fig::normalizacao_min_max}
%\end{figure}

\subsubsection{Domínio de amostragem}
%\subsection{Domínio esférico}
\label{ssec::dominio_esferico}

Tipicamente, as $S$ direções espaçadas para amostragem de dODFs,
$\mathbf{U} = [
\mathbf{\hat{u}}_1$, 
$\mathbf{\hat{u}}_2$, 
$\mathbf{\hat{u}}_3$, ..., 
$\mathbf{\hat{u}}_S]$ como ilustra a Fig. \ref{fig::direcoes}, são obtidas através das coordenadas dos pontos de uma malha esférica gerada por subdivisões sucessivas de um icosaedro inscrito numa esfera unitária, uma vez que as coordenadas dos pontos coincidem com as coordenadas dos vetores normais da esfera no ponto. Na comunidade de métodos de alta ordem para DWI, esta categoria de malha é amplamente utilizada \cite{yeh2010, TuchQBall2004, descoteaux2007} pois apresenta certas propriedades desejáveis  \cite{popko2012}:

\begin{enumerate}
    \item Os doze vértices do icosaedro são uniformemente\footnote{O conceito de uniformidade em uma distribuição de pontos em uma esfera, apesar de intuitivo, é algo cuja avaliação não se dá em apenas uma métrica. O Capítulo 9 de \cite{popko2012} introduz métricas para este fim e compara malhas esféricas obtidas a partir de subdivisões de sólidos de Platão.} distribuídos e estão contidos em uma esfera.
    \item Os triângulos que definem a sua face são equiláteros.
    \item Todos os vértices tem um vértice antipodal correspondente.
    \item Os pontos na malhas esféricas das subdivisões são \textit{quasi}-isotrópicos \cite{popko2012}.
\end{enumerate}

%\todo{\textcolor{green}{Na verdade, a questão do uso do icosaedro é algo que é um aparente consenso e ninguém coloca referência do motivo do uso. Só apenas menciona que usou. Eu entendo o uso mais pela minha experiência do que pela justificativa da comunidade.}}
%Das propriedades descritas, \citeonline{descoteaux2007} mostra que a \textit{quasi}-isotropia torna esta malha desejável para o cômputo de máximos locais e cômputo de distribuição de fibras subjacentes.\todo{Cap. 3?}\sout{e o fato de cada um dos seus vértices possuírem sua respectiva antípodas, permite que nós possamos nos aproveitar da simetria de ODFs de difusão para armazená-la em um só valor para ambas antípodas na memória.}

%\footnote{\citeonline{descoteaux2007} utiliza esta categoria de malha para cômputo de máximos locais.}

 \begin{figure}[ht]
 %\subfigcapskip = -5pt
     \centering
     \includegraphics[width=.8\linewidth, angle=0]{figs/HARDI/icosphere_normals.png}
     \caption{
     Ilustração da extração do conjunto de amostras $\mathbf{U}$ da malha esférica obtida através da tesselação de $4^a$ ordem do icosaedro. Os vetores em vermelho indicam os vetores em $\mathbf{U}$, extraídos a partir das normais dos pontos à esfera. As coordenadas dos vetores coincidem com as coordenadas das amostras em $\mathbf{U}$.% no hemisfério $y > 0 \cup (y = 0 \cap x > 0)$.
     }
     \label{fig::direcoes}
   \hspace{1pt}
 \end{figure}

 %Devido a simetria em relação aos eixos das funções de difusão, as amostramos apenas em uma semi-esfera
 
\citeonline{popko2012} discute diversas maneiras de aproximar uma esfera a partir de um icosaedro (Fig. \ref{fig::icosaedro}), entre as quais, escolhemos a subdivisão por cordas iguais  (\textit{Class I - Equal-Chords}). Esta subdivisão, além de manter a \textit{quasi}-uniformidade dos pontos na esfera, também herda do icosaedro a propriedade de que todos os pontos têm as suas respectivas antípodas no conjunto de vértices. A manutenção dos pares de antípodas é importante pois exploramos a simetria das dODFs para armazenarmos as amostras em uma semi-esfera (Fig. \ref{fig::direcoes}). Mencionamos a subdivisão por arcos iguais (\textit{Class I - Equal Arcs, three great circles}), a qual, além de gozar das mesmas propriedades presentes na subdivisão por cordas iguais, os vértices computados na subdivisão são mais uniformemente distribuídos na esfera, a custo de uma complexidade computacional maior.

\begin{figure}[H]
%\subfigcapskip = -5pt
    \centering
    \includegraphics[width=.3\linewidth, angle=0]{figs/HARDI/icosaedro.png}
    \caption{
    Icosaedro.
    }
    \label{fig::icosaedro}
   \hspace{1pt}
\end{figure}

A subdivisão por cordas iguais é efetuada em cada face do icosaedro. Para cada aresta do triângulo, um conjunto de segmentos paralelos à aresta e equidistantes entre si são traçados. As intersecções dos segmentos constituem novos vértices e são projetados na esfera. Fig. \ref{fig::icosaedro_faces_2} ilustra o procedimento de uma subdivisão. Traçamos somente um segmento paralelo a cada aresta da face triangular, equidistante da aresta e do vértice oposto à aresta. As intersecções, v01', v12' e v20', dividem as arestas em arcos iguais e são inseridos como novos vértices da malha. Esses vértices são, então, projetados sobre a esfera. O procedimento é feito em todas as faces da malha, conforme ilustrado nas Fig.\ref{fig::icosaedro_nao_norm}. Fig. \ref{fig::icosaedro_norm} mostra o espaço de amostras após a projeção de todos os novos vértices sobre a esfera unitária.

\begin{figure}[H]
    \centering
    \subfloat[Subdivisão dos pontos] {\includegraphics[width=.5\linewidth,  angle=0]{figs/Esquema_Glifo/ico_subdivision_2.png}
    \label{fig::icosaedro_faces_2}
    }
    \\
     \subfloat[Subdivisão dos triângulos do icosaedro.]{\makebox[1.35\width]
     {\includegraphics[width=.30\linewidth,  angle=0]{figs/HARDI/icosaedro_nao_norm.png}
    \label{fig::icosaedro_nao_norm}
    }
    }
     \subfloat[Resultado da projeção da subdivisão na esfera.]{\makebox[1.35\width]
     {\includegraphics[width=.35\linewidth,  angle=0]{figs/HARDI/icosaedro_norm.png}
    \label{fig::icosaedro_norm}
    }
    }
    \caption{ Ilustração da subdivisão por cordas iguais. Vértices do icosaedro destacados por círculos vermelhos.
    }
    \label{fig::triangle_subdivisao}
\end{figure}

%Traçamos um segmento paralelo a cada aresta, no qual é equidistante da aresta e do vértice oposto. Os vértices $v0'$, $v1'$ e $v2'$ consistem na intersecção dos segmentos com as arestas do triângulo. A projeção na esfera da interseção gera $v01$, $v12$ e $v20$, que são adicionados ao conjunto de pontos da subdivisão.

Na Fig. \ref{fig::icosaedro_subdivisao_4}, ilustramos o processo de subdivisão, no qual definimos a quantidade de segmentos paralelos a cada aresta dos triângulos igual a três, dividindo as arestas em quatro cordas iguais, resultando numa malha mostrada na Fig. \ref{fig::icosaedro_faces_4} que, após a projeção dos novos vértices sobre a esfera chegamos a um espaço de amostras ilustrado na Fig. \ref{fig::icosaedro_normalizada_4}.

\begin{figure}[H]
\centering
\captionsetup[subfloat]{farskip=0pt,nearskip=0pt}
\centering
    \subfloat[Novos vértices computados através da subdivisão de cada aresta em quatro segmentos] {\includegraphics[width=.45\linewidth, angle=0]{figs/HARDI/Subdivisao_icosaedro/divisao_faces_4.png}
    \label{fig::icosaedro_faces_4}
    }
    \hspace{1em}
    \subfloat[Novos vértices projetados na esfera.] {\includegraphics[width=.37\linewidth, angle=0]{figs/HARDI/Subdivisao_icosaedro/divisao_normalizada_4.png}
    \label{fig::icosaedro_normalizada_4}
    }
     \caption{Processo de subdivisão do icosaedro de quarta ordem.}
    \label{fig::icosaedro_subdivisao_4}
\end{figure}

Podemos sintetizar esta classe de subdivisão através de um parâmetro $t$, que indica a quantidade de subdivisões aplicadas a cada aresta do icosaedro. Nesta dissertação, referenciamos o processo descrito pela subdivisão por $t$ cordas iguais do icosaedro como a \textsf{$t$-ésima ordem de tesselação do icosaedro} ou \textsf{subdivisão de ordem $t$ do icosaedro}. Podemos também inferir a quantidade de vértices $N$ e de faces $\tau$ da malha em função de $t$ pelas expressões \cite{popko2012}:

\begin{equation}
\label{eq::icosphere_vertices}
    N = 10\times t^2 + 2
\end{equation}

\begin{equation}
\label{eq::icosphere_triangulos}
\tau = 20\times t^2
\end{equation}

%Observe que a projeção dos pontos intermediários adicionados na esfera subdivide cada aresta em dois e quatro, no exemplo ilustrados em Fig. \ref{fig::icosaedro_subdivisao} e \ref{fig::icosaedro_subdivisao_4}. Portanto, podemos referenciar esta categoria de subdivisão, que é classe I, na qual todas as arestas são divididas em $t$ segmentos de reta, pelo parâmetro $t$, no qual podemos inferir a quantidade de vértices e faces, representados nas Eq. \ref{eq::icosphere_vertices} e \ref{eq::icosphere_triangulos}, respectivamente \cite{popko2012}.


Neste trabalho, escolhemos a subdivisão por cordas iguais e restringimo-nos a categoria de malhas feitas através das subdivisões de ordem $2^k$ do icosaedro. Além de todos os vértices da malha possuírem suas antípodas, esta categoria de malha apresenta mais uma característica desejável: há uma regularidade nas facetas subdivididas. Algumas esferas aproximadas por tesselações de ordem $2^k$ do icosaedro estão ilustradas na Fig. \ref{fig::icosphere}. A quantidade de vértices para $2^a$, $4^a$, $8^a$ e $16^a$ ordem de tesselação é de 42, 162, 642 e 2562, respectivamente. Na Seção \ref{sec::renderizacao_de_glifos_ODF} do Capítulo \ref{chap::renderizacao_interativa_de_perfis_de_difusao}, discutiremos os aspectos computacionais da tesselação do icosaedro e descrevemos um algoritmo de tesselação.

\begin{figure}[ht]
\centering
\captionsetup[subfloat]{farskip=0pt,nearskip=0pt}
\centering
    \subfloat[Tesselação de $2^a$ ordem] {\includegraphics[width=.25\linewidth, angle=0]{figs/HARDI/Icosphere/icosphere_1.png}
    \label{fig::icosphere_1}
    }
    \hspace{1em}
    \subfloat[Tesselação de $4^a$ ordem] {\includegraphics[width=.25\linewidth, angle=0]{figs/HARDI/Icosphere/icosphere_2.png}
    \label{fig::icosphere_2}
    }
    \\
    \subfloat[Tesselação de $8^a$ ordem] {\includegraphics[width=.25\linewidth, angle=0]{figs/HARDI/Icosphere/icosphere_3.png}
    \label{fig::icosphere_3}
    }
    \hspace{1em}
    \subfloat[Tesselação de $16^a$ ordem]{\includegraphics[width=.25\linewidth, angle=0]{figs/HARDI/Icosphere/icosphere_4.png}
    \label{fig::icosphere_4}
    }
     \caption{Esferas obtidas através da tesselação de um icosaedro.}
    \label{fig::icosphere}
\end{figure}

%\sout{
%Escolhida a ordem de tesselação de amostragem do icosaedro, a partir do conjunto de pontos $\Pi = \{P_1, P_2, \dots, P_N\}$ vértices da malha centrada em $(0,0,0)$, categorizamos os pontos com subíndice ímpar $\Pi_{impar} = \{P_1, P_3, ..., P_{N-3}, P_{N-1}\}$ como os pontos contidos no hemisfério $\{P(x, y, z) \in \Pi | y > 0 \cup (y = 0 \cap x > 0)\}$, e o restante dos pontos da malha estão categorizadas em $\Pi_{par} = \{P_2, P_4, ..., P_{N-2}, P_{N}\}$. Observe que, devido a simetria da malha, as antípodas de um ponto em $\Pi_{impar}$ estão em $\Pi_{par}$ e vice versa. Adicionalmente, condicionamos que $P_{2i+2} = -P_{2i+1}$, $(0 \leq K \leq \frac{N-2}{2})$.
%}

%\footnote{Na Seção \ref{ssec::geometria_base} do Capítulo \ref{chap::renderizacao_interativa_de_perfis_de_difusao}, sugerimos diretrizes para a formulação da estrutura de dados dos pontos de $\Pi$.} 

%\sout{
%Para utilização mais eficiente do uso de memória, exploramos a simetria em relação aos eixos da SDF, i. e. $\psi_m(\mathbf{u}) = \psi_m(-\mathbf{u})$ e definimos $\mathbf{U}$ para normais dos vértices da malha esférica dos pontos em $\Pi_{impar}$, conforme ilustrado em Fig. \ref{fig::direcoes}. Logo, para malha esférica escolhida com $N$ vértices, $\mathbf{U}_{3\times \frac{N}{2}} = [
%\mathbf{n}_1,
%\mathbf{n}_3, ..., 
%\mathbf{n}_{N-3},
%\mathbf{n}_{N-1}
%]$, onde $\mathbf{n}_k$ é o vetor unitário com direção e sentido de $P_k$.
%}

%\sout{
%No que diz respeito ao acesso computacional, em $\boldsymbol{\psi_m}(\mathbf{r}) = [
% \psi_m(\mathbf{n}_1    )$,
%$\psi_m(\mathbf{n}_3    )$, ..., 
%$\psi_m(\mathbf{n}_{N-3})$,
%$\psi_m(\mathbf{n}_{N-1})
%]^T$, para a referência em uma direção $\mathbf{n}$ das normais das amostras do icosaedro tesselado, se $\mathbf{n} \in \mathbf{U}$, retornamos $\psi_m(\mathbf{n})$, caso contrário, retornamos $\psi_m(-\mathbf{n})$ referente à sua antípoda.
%}

%através de \textit{grids}  divisão de cada aresta do icosaedro em N segmentos  corresponde à N-ésima ordem de tesselação do icosaedro 

%modalidade de subdivisão do icosaedro para geração da esfera para geração dos \textit{grids} pode ser referenciada pela quantidade de segmentos que dividimos cada aresta para gerar os grids



%para a classe de subdivisão escolhida, classificaremos a tesselação do icosaedro quanto a quantidade de pontos . 

%\sout{Recomendamos que a ordem de tesselação para amostragem seja a oitava ou, no máximo, a décima sexta, implicando em 321 e 1281 amostras de ODF por \textit{voxel}. Para tesselação de oitava ordem, em que armazenamos os dados em um ponto flutuante de 4 \textit{bytes}, são necessários 1284 bytes por \textit{voxel}, que gera aproximadamente 4,480 \textit{Gigabytes} de memória para um volume de $145 \times 174 \times 145$ de memória do \textit{Human Connectome Project} \cite{essen2012}. Observe que há um alto uso de memória na codificação dos dados, e esta questão está relacionada ao armazenamento por amostras. Na área DWI, há métodos de alta ordem que visam codificar os dados como coeficientes de funções base \cite{descoteaux2007_QBI, tournier2007} e se comportam melhor neste aspecto.}

%Neste trabalho, restringimo-nos a categoria de malhas feitas através das subdivisões de ordem $2^k$ do icosaedro. Esta categoria de malha apresenta duas características desejáveis: a primeira se refere a presença de pares simétricos em relação aos eixos coordenados (i.e., se o ponto $P$ está na malha, $-P$ também está);\todo{Esta segunda característica vale para quaisquer subdivisões ...} a segunda se refere a \sout{possibilidade de tirar proveito da percepção visual na renderização de glifos ODF,}\textcolor{red}{regularidade das facetas subdivididas,} o que possibilita aumentar e diminuir a resolução dos glifos ODF de acordo com um modelo que relaciona sua ocupância na tela e resolução \textcolor{red}{mantendo a qualidade da malha}, conforme será detalhado no capítulo \ref{chap::renderizacao_interativa_de_perfis_de_difusao}.

%\sout{A quantidade de amostras em função da ordem de tesselação do icosaedro é dada por:}
%\begin{equation}
%\label{eq::icosphere_vertices}
%    N = 10\times t^2 + 2
%\end{equation}
%\sout{onde $t$ é a ordem de tesselação. A respeito das malhas esféricas mostradas na Fig. \ref{fig::icosphere}, a quantidade de vértices para $2^a$, $4^a$, $8^a$ e $16^a$ ordem de tesselação é 42, 162, 642 e 2562, respectivamente.}

%\sout{
%Seja o conjunto $\Pi = \{P_1, P_2, \dots, P_N\}$o conjunto de vértices da malha esférica obtida através da subdivisão do icosaedro. Para que possamos tomar vantagem da simetria de ODFs, condicionamos que $P_{2K+2} = -P_{2K+1}$ $(0 \leq K \leq \frac{N-2}{2})$.
%}

%\sout{
%Pode-se atribuir ao vetor $\mathbf{U} = [
%\mathbf{n}_1, 
%\mathbf{n}_2, ...,
%\mathbf{n}_{N-1},
%\mathbf{n}_N
%]$, nos quais cada $\mathbf{n}_i$ é o vetor unitário na direção e sentido do vetor normal de $P_i$ ($P_i \in \Pi$), no entanto podemos tirar vantagem da simetria da ODF e reduzir o seu tamanho pela metade. Os pontos simétricos em relação aos eixos da esfera tem normais em sentidos opostos, ou seja, $\mathbf{n}_{2K+2} = -\mathbf{n}_{2K+1}$, $(0 \leq K \leq \frac{N-2}{2})$. Observe que a função $\psi_m(\mathbf{r}, \mathbf{\hat{u}})$ (Eq. \ref{eq::sdf_discrete_2}) é simétrica em relação aos eixos em $\mathbf{\hat{u}}$, $\psi_m(\mathbf{r}, \mathbf{\hat{u}}) = \psi_m(\mathbf{r}, \mathbf{-\hat{u}})$, implicando que $\psi_m(\mathbf{r}, \mathbf{n}_{2K+2}) = \psi_m(\mathbf{r}, \mathbf{n}_{2K+1})$.
%}

%\sout{
%Assim, para utilização mais eficiente do uso de memória, definimos $\mathbf{U}$ para normais dos vértices da malha esférica, mapeando o par de normais de sentidos opostos em uma única direção. Logo $\mathbf{U}_{3\times \frac{N}{2}} = [
%\mathbf{n}_1,
%\mathbf{n}_3, ..., 
%\mathbf{n}_{N-3},
%\mathbf{n}_{N-1}
%]$, onde o vetor na K-ésima  posição de $\mathbf{U}$ é $\mathbf{\hat{n}}_{2K-1}$. Observe que após o cômputo, $\boldsymbol{R}(\mathbf{r})$ tem na K-ésima posição os valores de ODF associadas à $\mathbf{n}_{2K-1}$, e também a direção $\mathbf{n}_{2K}$.
%}

%\sout{
%Recomendamos que a ordem de tesselação para amostragem seja a oitava ou, no máximo, a décima sexta, implicando em 321 e 1281 amostras de ODF por \textit{voxel}. Valores acima destes computados para todo DWI pode incorrer no uso de uma quantidade proibitiva de memória.
%}



%Pode-se estabelecer que a estrutura de dados de $\mathbf{U}$ seja $[\mathbf{u_1}, \mathbf{u_2}, ..., \mathbf{u_{N-1}}, \mathbf{u_{N}}]^T$. Porém, podemos aproveitar a simetria dos dados e da malha esférica utilizada e organizarmos os dados de tal forma que um valor de ODF guardado na memória seja associado a duas direções simétricas.

\section{Visualização de Direções Intravóxeis}
\label{sec::vis_dODFs}

%Há duas formas de visualização de dados de ODF, que consistem em mapas escalares, onde codificam através de cor características de ODFs, como o mapa de anisotropia fracionada generalizada \cite{TuchQBall2004, yeh2010}, e através de glifos. Mapas escalares tendem a ser limitadas no que diz respeito de gerar a possibilidade de inferir sobre cruzamentos de fibra e síntese das ODFs, pois consistem em um mapeamento de centenas ou milhares de dados que geram ODFs em componentes em uma cor tricromática.  

Embora as dODFs provejam informações mais precisas sobre as direções de potenciais fibras que cruzam um \textit{voxel}, a grande quantidade de dados numéricos envolvidos em dODFs de um volume de ressonância magnética ponderada em difusão torna difícil avaliar a plausibilidade das amostras adquiridas em relação à anatomia da substância branca cerebral e aplicá-las para provas de conceito em esquemas de aquisição de alta resolução angular. A forma mais comum de superar esta dificuldade é visualizar os dados numéricos em glifos. 

Um glifo é um objeto gráfico projetado para representar um ou mais atributos quantitativos relacionados a um objeto de interesse, chamado de entidade, de forma que propicie a interpretação desses atributos pelo canal visual. Os atributos quantitativos do objeto são mapeadas em diferentes atributos gráficos de um glifo. Detalhes do projeto de um glifo para uma aplicação específica podem ser encontrados em \citeonline{ware2004}.

%\todo[inline]{Não é claro o que são atributos e o que são variáveis visuais na lista abaixo.}
%\textcolor{magenta}{\begin{enumerate}
%    \item posição espacial -  três dimensões (x, y, z);
%    \item cor - três dimensões (r, g, b);
%    \item forma - orientação e tamanho;
%    \item textura em superfície - tamanho e contraste.
%    \item codificação de movimento - duas/três dimensões; e
%    \item codificação por piscamento - uma dimensão.
%\end{enumerate}
%}

 \citeonline{Kindlmann2004} propõe glifos superquádricos para representar tensores de segunda ordem. Os autovalores são mapeados na forma de um glifo, enquanto os autovetores em orientações espaciais e cores dos glifos, como ilustra Fig. \ref{fig::intro_ex_DTI_glifos}. Ressaltamos que na Fig. \ref{fig::intro_ex_DTI_glifos}, os eixos x, y e z da cena são coerentes com a direção horizontal, vertical e normal aos planos anatômicos e as cores vermelho, verde e azul reforçam a informação da dominância das componentes x, y e z na orientação dos glifos. Estes glifos permitem sintetizar numa única imagem não só o comportamento local (intravóxel) de difusão como também as relações entre \textit{voxels} (intervóxel), quando glifos referentes aos \textit{voxels} vizinhos são renderizados lado a lado.

A forma mais difundida para visualizar os dados numéricos das ODFs são os glifos provenientes da superfície definida pela plotagem polar esférica $R(\mathbf{\hat{u}})$ \cite{descoteaux2015, TuchQBall2004}, introduzidos por \citeonline{tuch2002} em seu trabalho seminal. Como os glifos superquádricos, estes glifos permitem sintetizar numa única imagem não só o comportamento local (intravóxel) de difusão como também as relações entre \textit{voxels} renderizados lado a lado.
%\textcolor{red}{Esta seção apresenta as ideias básicas no projeto de glifos para representar a densidade de difusão em cada amostra de um volume de DWI.}
Nesta seção, apresentamos o projeto típico de glifos para representar ODFs referentes a cada \textit{voxel} em um volume DWI.

%\subsection{Glifos ODF}
\subsection{Mapeamento de Densidade de Probabilidade de Difusão em Formas Geométricas}
\label{sec::glifos_odf}

%Como descrito na seção \ref{sec::trabalhos_relacionados_glifos}
%\subsubsection{Superfície}

A superfície do glifo da ODF no \textit{voxel} na posição $\mathbf{r}$, $\psi(\mathbf{r}, \mathbf{\hat{u}})$, consiste na plotagem polar esférica $R(\mathbf{r} , \mathbf{\hat{u}})$ em $\mathbf{r}$

\begin{equation}
\label{eq::dODF2min_max}
    R(\mathbf{r} , \mathbf{\hat{u}}) = [ \frac{\boldsymbol{\psi}(\mathbf{r}, \mathbf{\hat{u}}) - \text{min}(\boldsymbol{\psi}(\mathbf{r}))}{\text{max}(\boldsymbol{\psi}(\mathbf{r})) - \text{min}(\boldsymbol{\psi}(\mathbf{r}))}],
\end{equation}
onde $\text{min}(\boldsymbol{\psi}(\mathbf{r}))$ e $\text{max}(\boldsymbol{\psi}(\mathbf{r}))$ são, respectivamente, o mínimo e o máximo dos $S$ valores associados de dODF na posição $\mathbf{r}$ obtidos com a Eq. \ref{eq::SDF2dODF_prob}. Em outras palavras, a plotagem polar esférica $R(\mathbf{r} , \mathbf{\hat{u}})$ é uma superfície na qual a distância radial na direção $\mathbf{\hat{u}}$ é dada por $R(\mathbf{r} , \mathbf{\hat{u}})$. Esta normalização foi sugerida por \citeonline{TuchQBall2004} com o objetivo de enfatizar as direções dominantes dos glifos.
O efeito da normalização está ilustrado na Fig. \ref{fig::normalizacao_min_max}. Por concisão, denotamos por $\boldsymbol{R}(\mathbf{r})$ a coleção de distâncias radiais de todas as amostras $\mathbf{U}$ no voxel $\mathbf{r}$.

% é dada por  na modulação do raio na direção $\mathbf{u}$ de uma esférica de acordo com uma versão normalizada do seu valor de imagem na função $R(\mathbf{u})$. A normalização que fizemos neste trabalho para representação está representado na equação \ref{eq::normglifo2}.

%\begin{equation}
%\label{eq::normglifo2}
%    R(\mathbf{u}) = \frac{R(\mathbf{u}) - min(R(\mathbf{u}))}{max(R(\mathbf{u})) - min(R(\mathbf{u}))}
%\end{equation}

%\begin{equation}
%\label{eq::dODF2min_max}
%    \boldsymbol{R}(\mathbf{r}) = [ \frac{\boldsymbol{\psi}(\mathbf{r}) - %\text{min}(\boldsymbol{\psi}(\mathbf{r}))}{\text{max}(\boldsymbol{\psi}(\mathbf{r})) %- \text{min}(\boldsymbol{\psi}(\mathbf{r}))}],
%\end{equation}
%onde $\text{min}(\boldsymbol{\psi}(\mathbf{r}))$ e $\text{max}(\boldsymbol{\psi}(\mathbf{r}))$ são, respectivamente, o mínimo e o máximo dos $S$ valores associados de dODF nas coordenadas $\mathbf{r}$ obtidos pela Eq. \ref{eq::SDF2dODF_prob}. 

\begin{figure}[ht]
\centering
\captionsetup[subfloat]{farskip=0pt,nearskip=0pt}
\centering
    \subfloat[ODF não normalizada] {\includegraphics[width=.30\linewidth, angle=0]{figs/HARDI/ODF_normalizacao/ODF-pura.png}
    \label{fig::odf_pura}
    }
    \hspace{1em}
    \subfloat[ODF min-max normalizada] {\includegraphics[width=.17\linewidth, angle=0]{figs/HARDI/ODF_normalizacao/ODF_minmax.png}
    \label{fig::odf_minmax}
    }
     \caption{Glifo da ODF com e sem a normalização min-max. %O Capítulo \ref{chap::renderizacao_interativa_de_perfis_de_difusao} traz a formulação com detalhes do glifo.
     }
    \label{fig::normalizacao_min_max}
\end{figure}

Embora haja um problema intrínseco à normalização min-max num meio isotrópico por realçar ruídos nos deslocamentos de difusão \cite{TuchQBall2004}, os glifos conseguem mostrar de forma efetiva o comportamento local das fibras na maioria dos casos.
%Observe que a normalização cancela o fator de escala $A_qL_{\Delta}$ da Eq. \ref{eq::s_ij}.
%\begin{equation}
%\label{eq::SDF2dODF}
%    \boldsymbol{R}(\mathbf{r}) = [ \frac{\boldsymbol{\psi}_m(\mathbf{r}) - %\text{min}(\boldsymbol{\psi}_m(\mathbf{r}))}{\text{max}(\boldsymbol{\psi}_m(\mathbf{r})) - %\text{min}(\boldsymbol{\psi}_m(\mathbf{r}))}], m = 1, \cdots, S
%\end{equation}
Observe em Fig. \ref{fig::glifo_ilustrado} que o glifo mais à esquerda tem uma componente forte na horizontal, o que sugere que a dODF tem uma fibra subjacente na horizontal. O glifo ODF localizado no meio sugere que há um cruzamento entre uma fibra na direção vertical e outra com uma leve inclinação na direção horizontal. E o glifo ODF à direita sugere que há uma fibra subjacente predominantemente na vertical.

\begin{figure}[ht]
%\subfigcapskip = -5pt
    \centering
    \includegraphics[width=.8\linewidth, angle=0]{figs/Esquema_Glifo/Glifos3Ex.png}
    \caption{Exemplos de glifos ODF. Os glifos consistem em uma superfície plotagem polar com a cor esquematizada de acordo com a equação \ref{eq::cor_glifo}.}
    \label{fig::glifo_ilustrado}
   \hspace{1pt}
\end{figure}

\subsection{Mapeamento de Orientações em Cores}
%\subsubsection{Cor}

Para realçar as orientações espaciais $\mathbf{\hat{u}} = (u_x, u_y, u_z)$  dos deslocamentos de difusão, é usual mapear as coordenadas de $\mathbf{\hat{u}}$ nas três cores primárias rgb, como ilustrado na Fig. \ref{fig::glifo_ilustrado}, através das expressões:

\begin{equation}
\label{eq::cor_glifo}
    r = |u_x| ~~~~ g = |u_y| ~~~~ b = |u_z|. 
\end{equation}

Considerando a convenção adotada em relação a planos anatômicos, em que a cor vermelha (r) representa a direção lateral, a verde (g), se refere a direção anteroposterior, e a azul (b), a direção inferior-superior, as
 cores enfatizam a orientação de uma ODF em relação aos planos anatômicos. Note que na Fig. \ref{fig::odf_minmax}, a ODF com uma forte componente na direção do eixo y (cor verde) indica que a difusão intravóxel é predominantemente anteroposterior (na direção bruços -- costas).

\subsection{Renderização Interativa}

Embora sejam conhecidos os procedimentos de mapeamento de dODFs em glifos, visualizá-los em tempo interativo para facilitar a exploração visual da difusividade e análise da plausibilidade das amostras escaneadas é ainda um problema. Fig. \ref{fig::QBall_glifos_coronal} ilustra uma potencial aplicação em que os glifos sobrepostos ao volume de difusão no ambiente de visualização multimodal apoiem na delineação da região de sementes de uma tractografia \cite{voltoline2021}.
No próximo capítulo, propomos um novo algoritmo interativo de renderização de glifos ODF acelerado por GPU e integrado ao ambiente de visualização multimodal a partir das dODF min-max normalizadas pré-computadas.

 \begin{figure}[H]
 %\subfigcapskip = -5pt
     \centering
     \includegraphics[width=0.7\linewidth, angle=0]{figs/Exemplos_QBall_visualizacao/Coronal.png}
     \caption{Fatia coronal de uma fatia DWI-b0 renderizada no ambiente de visualização multimodal de ressonância magnética e glifos ODF. O volume é artificial e usado no ISMRM \textit{Challenge} 2015 \cite{TractometerTool}.}
      \label{fig::QBall_glifos_coronal}
  %   \hspace{1pt}
 \end{figure}

%\subsubsection{Realce}


%\subsection{Posicionamento e escala}

%Renderizamos os glifos em um ambiente de visualização multimodal \cite{VMTKNeuro}, no qual estão sobrepostos ao volume anatômico co-registrado ao de difusão.

%No ambiente, cada glifo é posicionado no centro de seu \textit{voxel} e é escalonado para caber nele. Assim, o usuário pode inferir sobre as ODFs reconstruída em sua respectiva amostra na cena, bem como correlacioná-la mentalmente cada dODF com as outras dODFs localizadas em suas imediações.

%\input{cap3_daniel}
%\input{cap3_ting}
\input{cap3_final}

%\input{cap4_daniel}
%\input{cap4_ting}
\input{cap4_final}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Conclusão}
\label{chap::conclusao}

%\todo[inline]{Nas conclusões do seu trabalho, você deve retomar o seu ponto de partida (introdução). Pontos que devem constar: (1) redefinir o foco do seu projeto (renderização interativa dos glifos ODFs); (2) redefinir a sua tese (suas conjeturas); (3) sintetizar os principais problemas/desafios; (4) sintetizar os principais resultados/principais contribuições em relação ao estado-da-arte; (5) discutir potenciais aplicações caso haja; (6) discutir limitações; (7) apresentar suas sugestões para continuidade do trabalho.}

Neste trabalho abordamos a renderização interativa de glifos ODF, uma representação gráfica das funções densidade de orientações de difusão intravóxel (dODF). Essas funções são muito aplicadas para sintetizar os sinais de difusão obtidos em exames ponderados em difusão de alta resolução angular. Implementamos o método de alta ordem amostragem generalizada no espaço-Q \cite{yeh2010}. A principal motivação do trabalho vem do objetivo de termos uma visualização interativa das funções de distribuição de orientações de difusão obtidas através de métodos de alta ordem para difusão no ambiente de visualização multimodal VMTK-Neuro \cite{VMTKNeuro}, em desenvolvimento na Faculdade de Engenharia Elétrica e de Computação, e iniciarmos pesquisas na área de imagens de ressonância magnética de difusão de alta resolução angular almejando por uma reconstrução mais acurada de feixes de fibras nervosas.

A visualização interativa de dODFs é uma ferramenta muito útil na pesquisa da área. Quando representados em glifos, usuários podem inferir através de recursos pré-atencionais, como formas, cores, e até texturas \cite{ware2004}, sobre a coexistência de fibras subjacentes a partir de volumes de difusão, e sobre a plausibilidade das aquisições DWI e das suas sínteses em dODFs pelos métodos de alta ordem em relação aos feixes de fibras obtidos com dissecações. Adicionalmente, \citeonline{voltoline2021} mostraram que os glifos sobrepostos a um volume de ressonância magnética ponderada em T1 pode melhorar o processo de escolha de sementes para tractografia.

%Os desafios enfrentados dizem respeito à integração ao de um método de alta ordem para DWI ao VMTK-Neuro e a complexidade matemática envolvida para obtenção das dODFs, e a renderização dos dados obtidos em glifos. Na renderização de glifos,
Os desafios enfrentados ao longo do trabalho foram a quantidade de dados envolvidas na síntese de cada glifo em cada ODF e a alta escalabilidade demandada pelo VMTK-Neuro na renderização. A quantidade volumosa de dados discretos das dODFs, na ordem de $10^8$-$10^9$ \textit{bytes} para uma aquisição DWI inteira, impossibilita o armazenamento total das amostras das funções na maioria das GPU disponíveis no mercado e impõe um elevado tráfego de dados CPU-GPU num ambiente interativo. Neste trabalho, procuramos diminuir o tráfego de dados, remover as redundâncias dos dados na renderização e minimizar a ocupação na memória da GPU.

Em nossa proposta, sintetizamos os glifos da forma tradicional: aplicamos os valores escalares de ODFs min-max normalizados para deformar uma malha esférica. Os glifos são construídos em tempo de execução na GPU a partir de uma malha esférica instanciada. Adicionalmente, exploramos a simetria dODFs e as otimizações disponíveis no fluxo de renderização de triângulos da GPU para melhorar o desempenho do algoritmo e aplicamos a multi-resolução.
Com o intuito de otimizar os acessos aos dados multi-resolução otimizados na memória da GPU, utilizamos as tesselações do icosaedro de ordem potência de dois e descrevemos uma estrutura para as amostras de dODFs que prioriza acessos coalescentes.

Demonstramos através dos nossos experimentos que as estratégias aplicadas geram ganhos em desempenho e escalabilidade na renderização de glifos. Para alguns experimentos relacionados com a interatividade, 
integramos o algoritmo proposto no ambiente de visualização multimodal VMTK-Neuro \cite{VMTKNeuro}. Tiramos vantagem das funcionalidades de co-registro entre volumes de diferentes modalidades \cite{ting2014} e da visualização multimodal interativa presentes no VMTK-Neuro. Mostramos que o usuário pode explorar o comportamento de difusão intravóxel e intervóxel no ambiente oferecido pelo VMTK-Neuro.

Vale ressaltar que os princípios expostos neste trabalho podem ser aplicados à renderização de qualquer tipo de função de distribuição de orientações renderizados em sua plotagem polar esférica. A funcionalidade da deformação de uma malha esférica instanciada na GPU, a configuração de multi-resolução, e de acessos coalescentes de memória na GPU de escalares de ODFs que deformam a malha são universais e se encaixam em qualquer procedimento de renderização de ODF na GPU.

\todo[inline]{Adicionar uma referência de compressão na GPU. Veja \url{https://developer.nvidia.com/blog/optimizing-data-transfer-using-lossless-compression-with-nvcomp/}}

A principal limitação  do algoritmo na forma como propomos se dá em termos de memória para amostras de dODF. Consideramos que as funções são armazenadas como dados discretos e em multi-resolução e, para o conjunto de malhas que utilizamos, esses dados pré-computados crescem exponencialmente a uma quantidade proibitiva de memória. Acreditamos que seja pertinente investigar uma alternativa para contornar o problema de processamento de grande volume de dados. Técnicas conhecidas, como compressão acelerada por \textit{hardware} \cite{sakharnykh2020} e subdivisões do volume de dados (\textit{bricking}) \cite{Beyer2014}, devem ser avaliadas.

%Neste trabalho abordamos a renderização\textcolor{red}{, em tempo interativo,} de funções de distribuição de \todo{dODF?}orientação de métodos de alta ordem para DWI\sout{integrado a um ambiente de visualização multimodal que envolve DWI co-registrado a volumes escalares de outras modalidades \cite{VMTKNeuro}}. Para alcançar este objetivo, implementamos o cômputo do método de alta ordem Amostragem Generalizada no Espaço-Q e a visualização das ODFs estimadas, aproveitando a infraestrutura e funcionalidades implementadas de co-registro entre dois volumes \cite{ting2014} e a infraestrutura para renderização multimodal para DTI e glifos superquádricos \cite{voltoline2021}.

%Para estimação de ODFs de difusão, implementamos o cômputo do método de imageamento amostragem generalizada no espaço-Q de acordo com o sugerido por \citeonline{yeh2010}. Derivamos o método até chegarmos em uma formulação que relaciona o sinal e o perfil de difusão em uma ODF através de uma multiplicação matricial. Armazenamos as ODFs em amostras e exploramos sua simetria para armazenarmos ODFs associadas a sentidos opostos em um somente um valor.

%A fim de prover um ambiente que se propõe a ser utilizado para avaliação de ODFs, desenvolvemos um algoritmo de renderização de ODFs em glifos, nos quais são posicionados em seus respectivos \textit{voxels} no ambiente de visualização. Nos baseamos no algoritmo de renderização multimodal para volumes de ressonância magnética DWI e T1 co-registrados com glifos superquádricos proposto por \citeonline{voltoline2021} e exploramos a simetria das dODFs e a percepção visual humana para renderizar os glifos em tempo interativo.

%Levando estes pontos em consideração, propomos uma forma de estruturar dados de amostras de ODF armazenadas na CPU. Adicionalmente, propomos o cômputo da resolução da malha, como os dados são enviados e acessados na GPU para gerar cada um dos glifos e como utilizamos a renderização por instâncias para gerar múltiplos glifos com um comando de desenho.



%\section{Futuros Trabalhos}

Para futuros trabalhos, sugerimos pesquisar algoritmos para cômputo da distribuição local de fibras subjacentes às dODFs através de seus máximos locais, bem como pesquisar e desenvolver uma abordagem de tractografia a partir da distribuição local de fibras, como mostrado no fluxograma da Fig. \ref{fig::flowchart_vmtk_hardi}.
Ambos os temas são ainda um problema em aberto e alguns dos desafios da área podem ser encontrados em \citeonline{SCHILLING2019194}.
Encorajamos experimentar usar os glifos ODF para escolha das sementes. 
Para estimativa da trajetória de uma fibra, aventamos explorar o trabalho de \citeonline{chamberland2014}, que propuseram um algoritmo interativo baseado em máximos locais de dODFs pré-computados. A nossa análise preliminar nos faz acreditar que o procedimento proposto por \citeonline{chamberland2014} está em conformidade com a arquitetura do VMTK-Neuro.

%Por questões de otimização no uso de memória, que é muito demandada por dados gerados a partir de métodos de alta ordem, destacamos a importância da integração de um algoritmo de segmentação do cérebro ao VMTK-Neuro para aquisição de difusão, para que métodos de alta ordem não aloquem memória para \textit{voxels} que não estão contidos no cérebro.

%\subsection{Renderização interativa de glifos ODF}
%Na renderização de glifos ODF, podemos investigar e adaptar o uso das estratégias mostradas no algoritmo de renderização de glifos ODF que propomos para  uso em funções que estejam representadas como uma soma ponderada de harmônicas esféricas, que são frequentemente utilizadas na comunidade de pesquisa de métodos de alta ordem \cite{descoteaux2007_QBI, Tournier2004DirectEO, tournier2007}.

%\subsection{DWI e tractografia}






%Adicionalmente, as funcionalidade para visualização interativa para métodos de alta ordem de alta ordem no ambiente de visualização multimodal pode ser utilizada para visualizar e depurar a implementação e investigação de outros métodos de alta ordem, caso seja do interesse do grupo de pesquisa.


%bem como desenvolver aplicações de visualização associadas. Adaptando muito do que já fora desenvolvido para o DTI, as aplicações desenvolvidas para o método consistem na estimação de ODFs via transformada de Funk-Radon, visualização em tempo interativo de ODFs em glifos e o desenvolvimento de um algoritmo de tractografia associado.

%Objetivando prover um ambiente que permite a avaliação de ODFs, aproveitando as funcionalidades presentes no VMTK-Neuro para exploração de DWIs e MRI anatômicos, foi desenvolvido um esquema de renderização em tempo interativo que mapeia as ODFs em suas representações gráficas polares esféricas.

%Com o objetivo de melhorar e tractografia baseada em DTI, foi implementado um protótipo de algoritmo de tractografia baseado em um conjunto de direções de métodos HARDI. !!(No trato corticoespinhal, no qual o DTI não consegue resolver).
%Adicionalmente, a tractografia gera resultados em tempo interativo para o usuário, permitindo-o explorar livremente para diferentes parâmetros.

%\section{Futuros trabalhos}

%Na renderização de glifos, pode-se implementar o cômputo de vetores normais para serem usados na iluminação das superfícies, o que é algo comum na apresentação por glifos. Adicionalmente, podemos implementar as representações polares esféricas sugerida por \citeonline{hlawitschka2012} e/ou \citeonline{almsick2011} para fins de comparação de performance com a nossa abordagem.

%Em tractografia, o próximo passo é a implementação do afiamento de ODFs, o que melhora extração de direções plausíveis de direções a serem usadas no \textit{tracking} de fibras \cite{fillard2011, SCHILLING2019194}.
\pagebreak
 %\chapter{Apêndice}
 %\section{Qualidade visual dos glifos a uma visão distante}
 %\label{sec::qualidade_visual_longe}


% \section{Imagens de ODFs mapeadas em glifos renderizadas no VMTK-Neuro}

% \label{section::QBall_Glifos}


 %\section{Expressões analíticas para harmônicas esféricas}
 
% \begin{figure}[H]
% \label{fig::QBall_glifos_sagital}
% %\subfigcapskip = -5pt
%     \centering

%     \includegraphics[width=.7\linewidth, angle=0]{figs/Exemplos_QBall_visualizacao/Sagital.png}
%     \caption{Projeção Sagital.}
%  %   \hspace{1pt}
% \end{figure}

% \begin{figure}[H]
% \label{fig::QBall_glifos_coronal}
% %\subfigcapskip = -5pt
%     \centering

%     \includegraphics[width=0.7\linewidth, angle=0]{figs/Exemplos_QBall_visualizacao/Coronal.png}
%     \caption{Projeção Coronal.}
%  %   \hspace{1pt}
% \end{figure}

% \begin{figure}[H]
% \label{fig::QBall_glifos_Coronal_CC_CS}
% %\subfigcapskip = -5pt
%     \centering
%     \includegraphics[width=.7\linewidth, angle=0]{figs/Exemplos_QBall_visualizacao/Coronal_Cruzamento_MapaFA.png}
%     \caption{Projeção Coronal - Região de cruzamento de fibras. Glifos renderizado sobre mapa FA codificado por cores do DTI.}
%  %   \hspace{1pt}
% \end{figure}

% \begin{figure}[H]
% \label{fig::QBall_glifos_azul}
% %\subfigcapskip = -5pt
%     \centering

%     \includegraphics[width=.4\linewidth, angle=0]{figs/Exemplos_QBall_visualizacao/Glifo_Azul.png}
%     \caption{Glifo referente a um voxel com direção de difusão predominantemente ascendente.}
%  %   \hspace{1pt}
% \end{figure}

\pagebreak


% \section{\textit{Overplus} e problemas com o mapeamento do sinal de difusão em ODFs}
% \label{ssec::problema_overplus}

% Após um estudo que visou comparar ODFs geradas a partir de diferentes esquemas de amostragem de gradientes de ponderação de difusão, concluímos que a falta de uniformidade do conjunto de gradientes do \textit{Overplus} no domínio esférico compromete a interpolação de sinais de difusão no processo de cômputo do \textit{Q-Ball}. A figura \ref{fig::shell_Overplus_VS_ISMRM} mostra a distribuição no \textit{shell}\footnote{\textit{Shell} é um consiste em um conjunto definido em uma esfera.} das direções dos gradientes do \textit{Overplus}, em adição ao utilizado no volume ISMRM 2015.

% \begin{figure}[ht]
% \centering
% \captionsetup[subfloat]{farskip=5pt,nearskip=0pt}
%     %!!VER SE ISSO TA CERTO
%     \subfloat[\textit{Overplus}.] {\includegraphics[width=.4\linewidth, angle=0]{figs/Overplus_VS_ISMRM/shell_overplus.png}}    
%     \hfill
%     \subfloat[Esquema utilizado no ISMRM.]{\includegraphics[width=.4\linewidth, angle=0]{figs/Overplus_VS_ISMRM/shell_ismrm.png}}
%      \caption{Domínio esférico com pontos de amostragem referentes a direção de gradientes de difusão. Vermelho: direções de amostragem. Azul: sentido oposto da direção de amostragem.}
%     %\hfill
%     \label{fig::shell_Overplus_VS_ISMRM}
% \end{figure}


% Um bom conjunto de gradientes de codificação de difusão vinculada a um DWI não tem uma preferência direcional, as amostras no domínio esférico possuem uma boa invariância à orientação das estruturas do tecido ou coordenadas da máquina e a separação angular entre um par de pontos mais próximos é máxima e constante para todos os elementos \cite{cheng2018}. Um conjunto que segue essas propriedades estão distribuídos uniformemente sobre o \textit{shell}.

% Há uma certa concordância na literatura de que uma uniformidade no domínio esférico em aquisições \textit{single shell}\footnote{Denomina-se aquisição \textit{single shell} como volumes de ressonância de difusão escaneados com apenas um valor b, além do b0.} é importante para uma boa reconstrução de ODFs. \citeonline{yeh2010} mencionam a importância da uniformidade além de propor uma métrica para aferir o seu grau. \citeonline{cheng2018} discorrem sobre formulações de esquemas de amostragem de gradientes de forma uniforme e mencionam as suas vantagens.

% Como parte do processo de investigação dos resultados não esperados de ODFs gerados a partir dos volumes adquiridos através do protocolo \textit{Overplus}, foram escaneados para um mesmo indivíduo um volume com o conjunto de direções da competição ISMRM, o padrão, e um usando o protocolo \textit{Overplus} da Philips, em que todos possuem a mesma resolução angular de 32 direções. A análise feita consistiu na inspeção da forma dos glifos na região do corpo caloso que contém uma forte componente na direção mediolateral. A localização desta região se dá através do mapa FA codificado por cor gerado pelo DTI, em que não foi constatado nenhum problema nestes esquemas de aquisição.


% Nesta inspeção, foi possível gerar glifos das ODFs razoáveis para o esquema de amostragem do ISMRM (Figura \ref{fig::Overplus_VS_ISMRM_b}), o que não aconteceu com o \textit{Overplus}, em que as ODFs ficaram totalmente descaracterizadas em comparação com os códigos de cores, conforme mostrado na Figura \ref{fig::Overplus_VS_ISMRM_a}.

% \begin{figure}[ht]
% \centering
% \captionsetup[subfloat]{farskip=5pt,nearskip=0pt}
    
%     \subfloat[\textit{Overplus}] {\label{fig::Overplus_VS_ISMRM_a} \includegraphics[width=.45\linewidth, angle=0, ]{figs/Overplus_VS_ISMRM/Overplus.png}}
%     \hfill
%     \subfloat[Esquema da competição ISMRM]{\label{fig::Overplus_VS_ISMRM_b} \includegraphics[width=.47\linewidth, angle=0]{figs/Overplus_VS_ISMRM/ISMRM.png}}
%     %\hfill
%     \caption{Glifos do Corpo Caloso - Mediolateral. Glifos de ODF sobre mapa FA codificado por cor do DTI.} %!!VER SE ISSO TA CERTO
%     \label{fig::Overplus_VS_ISMRM}
% \end{figure}
\pagebreak


%\bibliographystyle{}
\bibliography{references.bib}

% ----------------------------------------------------------
% Glossário
% ----------------------------------------------------------
%
% Consulte o manual da classe abntex2 para orientações sobre o glossário.
%
%\glossary

% ----------------------------------------------------------
% Apêndices
% ----------------------------------------------------------

% ---
% Inicia os apêndices
% ---
\begin{apendicesenv}
\chapter{Dados da série de experimentos: Ganhos em desempenho}
\label{ap::dados_serie_experimentos_1}

Neste apêndice, apresentamos os dados de desempenho relativos à série de experimentos para renderização de glifos para diferentes ordens de tesselação do icosaedro, conforme descrita na Seção \ref{sec::funcionalidades_agregadas_e_ganhos_de_performance} do Capítulo \ref{sec::experimentos}. Foram utilizadas as tesselações de ordem 2, 4, 8 e 16 do icosaedro para o cômputo do tempo de renderização dos glifos.

A primeira série de experimentos se refere à funcionalidade de indexação e síntese do glifo na CPU, a segunda série se refere à adição da funcionalidade de instanciação na renderização e a síntese do glifo na GPU, a terceira série se refere à exploração da simetria das ODFs para diminuição do uso de memória e tráfego de dados CPU-GPU dos escalares que sintetizam a ODF e o quarto experimento se refere ao uso da memória da GPU em um leiaute tal que os acessos dos escalares de ODF que sintetizam os glifos ocorrem de forma coalescente.

\begin{table}[htb]
\begin{tabular}{c|c|c|c|c|}
\cline{2-5}
\textbf{}                       & \multicolumn{4}{c|}{\textbf{Série de experimentos - $\mathbf{2^a}$ ordem de tesselação do icosaedro}} \\ \hline
\multicolumn{1}{|c|}{\# glifos} & Série 1 - FPS       & Série 2 - FPS  & Série 3 - FPS         & Série 4 - FPS       \\ \hline
\multicolumn{1}{|c|}{25}        & 132.37              & 132.08         & 125.64                & 126.56              \\ \hline
\multicolumn{1}{|c|}{100}       & 156.28              & 160.46         & 155.89                & 168.67              \\ \hline
\multicolumn{1}{|c|}{225}       & 152.88              & 162.48         & 167.42                & 168.83              \\ \hline
\multicolumn{1}{|c|}{400}       & 151.03              & 156.80         & 162.13                & 157.03              \\ \hline
\multicolumn{1}{|c|}{625}       & 140.79              & 153.49         & 153.33                & 152.96              \\ \hline
\multicolumn{1}{|c|}{900}       & 137.64              & 151.99         & 150.26                & 149.96              \\ \hline
\multicolumn{1}{|c|}{1225}      & 128.39              & 145.31         & 148.00                & 148.88              \\ \hline
\multicolumn{1}{|c|}{1600}      & 121.80              & 149.86         & 149.20                & 145.49              \\ \hline
\multicolumn{1}{|c|}{2025}      & 117.71              & 146.09         & 147.94                & 143.90              \\ \hline
\multicolumn{1}{|c|}{2500}      & 109.65              & 145.39         & 146.85                & 142.34              \\ \hline
\multicolumn{1}{|c|}{3025}      & 100.40              & 137.55         & 144.77                & 142.27              \\ \hline
\multicolumn{1}{|c|}{3600}      &  96.21              & 135.94         & 143.75                & 139.04              \\ \hline
\multicolumn{1}{|c|}{4225}      &  87.55              & 138.05         & 141.43                & 138.41              \\ \hline
\multicolumn{1}{|c|}{4900}      &  84.53              & 134.36         & 139.63                & 136.13              \\ \hline
\multicolumn{1}{|c|}{5625}      &  81.45              & 131.23         & 137.79                & 134.23              \\ \hline
\multicolumn{1}{|c|}{6400}      &  73.70              & 123.79         & 135.52                & 123.39              \\ \hline
\multicolumn{1}{|c|}{7225}      &  69.84              & 123.15         & 133.85                & 126.02              \\ \hline
\multicolumn{1}{|c|}{8100}      &  68.35              & 121.69         & 129.59                & 123.46              \\ \hline
\multicolumn{1}{|c|}{9025}      &  60.67              & 121.69         & 126.97                & 121.36              \\ \hline
\multicolumn{1}{|c|}{10000}     &  58.81              & 115.12         & 124.09                & 121.33              \\ \hline
\end{tabular}
\caption{Dados de desempenho em FPS médio referentes a série de experimentos descritos na Seção \ref{sec::funcionalidades_agregadas_e_ganhos_de_performance} para tesselação de segunda ordem do icosaedro.}
\label{tab::testes_2}
\end{table}

\begin{table}[htb]
\begin{tabular}{c|c|c|c|c|}
\cline{2-5}
\textbf{}                       & \multicolumn{4}{c|}{\textbf{Série de experimentos - $\mathbf{4^a}$ ordem de tesselação do icosaedro}} \\ \hline
\multicolumn{1}{|c|}{\# glifos} & Série 1 - FPS       & Série 2 - FPS  & Série 3 - FPS         & Série 4 - FPS       \\ \hline
\multicolumn{1}{|c|}{25}        &  131.75              & 137.51         & 127.31                & 129.69              \\ \hline
\multicolumn{1}{|c|}{100}       &  150.55              & 160.69         & 162.86                & 161.10              \\ \hline
\multicolumn{1}{|c|}{225}       &  141.80              & 151.60         & 153.54                & 151.72              \\ \hline
\multicolumn{1}{|c|}{400}       &  124.41              & 149.85         & 149.84                & 149.69              \\ \hline
\multicolumn{1}{|c|}{625}       &  113.23              & 143.47         & 148.88                & 147.70              \\ \hline
\multicolumn{1}{|c|}{900}       &  101.19              & 138.53         & 146.87                & 144.87              \\ \hline
\multicolumn{1}{|c|}{1225}      &   87.74              & 138.85         & 143.58                & 143.58              \\ \hline
\multicolumn{1}{|c|}{1600}      &   78.38              & 134.39         & 137.85                & 137.49              \\ \hline
\multicolumn{1}{|c|}{2025}      &   67.82              & 131.25         & 140.52                & 138.21              \\ \hline
\multicolumn{1}{|c|}{2500}      &   59.75              & 121.61         & 137.32                & 136.66              \\ \hline
\multicolumn{1}{|c|}{3025}      &   57.44              & 120.16         & 134.48                & 132.83              \\ \hline
\multicolumn{1}{|c|}{3600}      &   48.52              & 111.35         & 129.92                & 122.40              \\ \hline
\multicolumn{1}{|c|}{4225}      &   39.96              & 109.93         & 121.74                & 123.25              \\ \hline
\multicolumn{1}{|c|}{4900}      &   36.63              & 100.91         & 120.94                & 118.88              \\ \hline
\multicolumn{1}{|c|}{5625}      &   32.90              &  99.59         & 119.10                & 117.62              \\ \hline
\multicolumn{1}{|c|}{6400}      &   29.50              &  89.65         & 112.00                & 111.66              \\ \hline
\multicolumn{1}{|c|}{7225}      &   27.41              &  83.97         & 101.50                & 102.92              \\ \hline
\multicolumn{1}{|c|}{8100}      &   25.08              &  82.04         &  92.44                & 100.01              \\ \hline
\multicolumn{1}{|c|}{9025}      &   22.96              &  72.30         &  97.35                &  90.76              \\ \hline
\multicolumn{1}{|c|}{10000}     &   21.11              &  67.68         &  97.41                &  87.65              \\ \hline
\end{tabular}
\caption{Dados de desempenho em FPS médio referentes a série de experimentos descritos na Seção \ref{sec::funcionalidades_agregadas_e_ganhos_de_performance} para tesselação de quarta ordem do icosaedro.}
\label{tab::testes_4}
\end{table}

\begin{table}[htb]
\begin{tabular}{c|c|c|c|c|}
\cline{2-5}
\textbf{}                       & \multicolumn{4}{c|}{\textbf{Série de experimentos - $\mathbf{8^a}$ ordem de tesselação do icosaedro}} \\ \hline
\multicolumn{1}{|c|}{\# glifos} & Série 1 - FPS       & Série 2 - FPS  & Série 3 - FPS         & Série 4 - FPS       \\ \hline
\multicolumn{1}{|c|}{25}        &  125.59              & 132.73         & 131.89                & 134.87              \\ \hline
\multicolumn{1}{|c|}{100}       &  122.72              & 150.18         & 151.36                & 148.87              \\ \hline
\multicolumn{1}{|c|}{225}       &   97.11              & 142.54         & 150.68                & 149.36              \\ \hline
\multicolumn{1}{|c|}{400}       &   79.04              & 144.11         & 143.47                & 141.53              \\ \hline
\multicolumn{1}{|c|}{625}       &   59.22              & 137.77         & 134.51                & 134.48              \\ \hline
\multicolumn{1}{|c|}{900}       &   46.12              & 115.71         & 132.32                & 132.19              \\ \hline
\multicolumn{1}{|c|}{1225}      &   36.20              & 104.36         & 122.08                & 122.19              \\ \hline
\multicolumn{1}{|c|}{1600}      &   29.51              &  98.80         & 115.23                & 118.47              \\ \hline
\multicolumn{1}{|c|}{2025}      &   24.63              &  81.37         &  95.99                & 101.44              \\ \hline
\multicolumn{1}{|c|}{2500}      &   20.56              &  71.75         &  94.46                &  91.85              \\ \hline
\multicolumn{1}{|c|}{3025}      &   17.75              &  61.18         &  84.55                &  94.48              \\ \hline
\multicolumn{1}{|c|}{3600}      &   15.24              &  59.98         &  76.32                &  78.50              \\ \hline
\multicolumn{1}{|c|}{4225}      &   13.31              &  52.69         &  66.50                &  68.81              \\ \hline
\multicolumn{1}{|c|}{4900}      &    8.28              &  46.50         &  58.92                &  63.55              \\ \hline
\multicolumn{1}{|c|}{5625}      &    7.31              &  41.58         &  49.43                &  56.91              \\ \hline
\multicolumn{1}{|c|}{6400}      &    6.46              &  37.77         &  42.18                &  49.74              \\ \hline
\multicolumn{1}{|c|}{7225}      &    5.76              &  34.37         &  38.00                &  43.18              \\ \hline
\multicolumn{1}{|c|}{8100}      &    5.21              &  30.51         &  34.14                &  38.95              \\ \hline
\multicolumn{1}{|c|}{9025}      &    2.57              &  29.04         &  30.86                &  35.29              \\ \hline
\multicolumn{1}{|c|}{10000}     &    2.31              &  25.61         &  28.13                &  32.06              \\ \hline
\end{tabular}
\caption{Dados de desempenho em FPS médio referentes a série de experimentos descritos na Seção \ref{sec::funcionalidades_agregadas_e_ganhos_de_performance} para tesselação de oitava ordem do icosaedro.}
\label{tab::testes_8}
\end{table}




\begin{table}[htb]
\begin{tabular}{c|c|c|c|c|}
\cline{2-5}
\textbf{}                       & \multicolumn{4}{c|}{\textbf{Série de experimentos - $\mathbf{16^a}$ ordem de tesselação do icosaedro}} \\ \hline
\multicolumn{1}{|c|}{\# glifos} & Série 1 - FPS             & Série 2 - FPS             & Série 3 - FPS             & Série 4 - FPS            \\ \hline
\multicolumn{1}{|c|}{25}        & 108.50                    & 127.90                    & 130.75                    & 127.78                   \\ \hline
\multicolumn{1}{|c|}{100}       & 75.76                     & 140.63                    & 141.25                    & 140.74                   \\ \hline
\multicolumn{1}{|c|}{225}       & 46.91                     & 120.05                    & 131.80                    & 133.71                   \\ \hline
\multicolumn{1}{|c|}{400}       & 29.73                     & 97.77                     & 115.82                    & 121.22                   \\ \hline
\multicolumn{1}{|c|}{625}       & 21.08                     & 74.27                     & 104.28                    & 93.24                    \\ \hline
\multicolumn{1}{|c|}{900}       & 15.50                     & 60.03                     & 77.01                     & 81.40                    \\ \hline
\multicolumn{1}{|c|}{1225}      & 8.59                      & 49.54                     & 59.49                     & 64.58                    \\ \hline
\multicolumn{1}{|c|}{1600}      & 6.70                      & 39.86                     & 47.07                     & 51.35                    \\ \hline
\multicolumn{1}{|c|}{2025}      & 5.36                      & 32.86                     & 37.15                     & 41.61                    \\ \hline
\multicolumn{1}{|c|}{2500}      & 2.39                      & 25.67                     & 28.17                     & 33.41                    \\ \hline
\multicolumn{1}{|c|}{3025}      & 1.98                      & 21.47                     & 23.60                     & 27.30                    \\ \hline
\multicolumn{1}{|c|}{3600}      & 1.66                      & 18.76                     & 20.08                     & 23.17                    \\ \hline
\multicolumn{1}{|c|}{4225}      & 1.39                      & 16.02                     & 17.22                     & 19.94                    \\ \hline
\multicolumn{1}{|c|}{4900}      & 1.05                      & 14.00                     & 14.95                     & 17.27                    \\ \hline
\multicolumn{1}{|c|}{5625}      & 0.91                      & 12.11                     & 13.05                     & 15.10                    \\ \hline
\multicolumn{1}{|c|}{6400}      & 0.80                      & 10.91                     & 11.53                     & 13.32                    \\ \hline
\multicolumn{1}{|c|}{7225}      & 0.71                      & 9.87                      & 10.24                     & 11.84                    \\ \hline
\multicolumn{1}{|c|}{8100}      & 0.63                      & 8.96                      & 9.15                      & 10.59                    \\ \hline
\multicolumn{1}{|c|}{9025}      & 0.57                      & 8.02                      & 8.22                      & 9.52                     \\ \hline
\multicolumn{1}{|c|}{10000}     & 0.45                      & 7.18                      & 7.44                      & 8.61                     \\ \hline
\end{tabular}


\caption{Dados de desempenho em FPS médio referentes a série de experimentos descritos na Seção \ref{sec::funcionalidades_agregadas_e_ganhos_de_performance} para tesselação de décima-sexta ordem do icosaedro.}
\label{tab::testes_16}
\end{table}

\chapter{Dados da série de experimentos: Multi-Resolução}
\label{ap::performance_vmtk}

Neste apêndice, apresentamos os dados de desempenho relativos à série de experimentos para renderização de glifos que validam a funcionalidade de multi-resolução para o algoritmo proposto integrado ao VMTK-Neuro \cite{VMTKNeuro}, conforme descrito na Seção \ref{sec::multi_resolução_e_performance_em_ambiente_de visualização_multimodal} do Capítulo \ref{sec::experimentos}.

Integramos o algoritmo de renderização de glifos ODF no VMTK-Neuro com as funcionalidades exploradas e que trazem ganhos em desempenho do algoritmo. Na Tabela \ref{tab::glyph_info_experiment_fixed}, mostramos os dados de desempenho associados ao glifo sintetizado a partir da malha esférica obtida através da 8$^a$ ordem de tesselação do icosaedro e na Tabela \ref{tab::glyph_info_experiment}, habilitamos o cômputo da ocupação máxima $max_p$ em \textit{pixels} em tela da projeção de um \textit{voxel} para seleção da resolução apropriada.



\begin{table}[ht]
\centering
\begin{tabular}{|cccc|}
\hline
 \textbf{Fator de escala} &  \textbf{FPS} & \textbf{\# glifos} & \textbf{\begin{tabular}[c]{@{}c@{}}Ordem de \\ tesselação\end{tabular}} \\ \hline
91.62    & 33.48  & 12     & 8 \\
61.08    & 35.23  & 20     & 8 \\
40.72    & 35.43  & 42     & 8 \\
27.15    & 35.83  & 90     & 8 \\
18.10    & 32.78  & 182    & 8 \\
12.06    & 35.70  & 380    & 8 \\
8.04	 & 32.96  & 870    & 8 \\
5.36	 & 28.53  & 1892   & 8 \\
3.57	 & 23.17  & 4160   & 8 \\
2.38	 & 14.58  & 9166   & 8 \\
1.59	 & 7.96   & 13205  & 8 \\
\hline
\end{tabular}
\caption{Ambiente de visualização multimodal com glifos ODF renderizados em uma imagem $850\times 850$ com a malha esférica base fixa. Fig. \ref{fig::qualidade_visual_longe_highres} teve em sua geração, os parâmetros da última linha da tabela.
}
\label{tab::glyph_info_experiment_fixed}
\end{table}

\begin{table}[ht]
\centering
\begin{tabular}{|ccccc|}
\hline
\textbf{Fator de escala} & \textbf{FPS} & \textbf{\# glifos}  & \textbf{\begin{tabular}[c]{@{}c@{}}Ordem de    \\ tesselação\end{tabular}} & $\mathbf{max_p}$    \\ \hline
91.62   & 29.62 & 12	   & 8 & 115958    \\
61.08   & 30.55 & 20	   & 8 & 51753    \\
40.72   & 31.52 & 42	   & 8 & 23103    \\
27.15   & 31.59 & 90	   & 8 & 10302    \\
18.10   & 31.37 & 182   & 8 & 4623    \\
12.06   & 31.65 & 380   & 8 & 2025    \\
8.04    & 31.55 & 870   & 4 & 900    \\
5.36    & 30.95 & 1892  & 4 & 400    \\
3.57    & 28.11 & 4160  & 4 & 196    \\
2.38    & 20.86 & 9166  & 4 & 81    \\
1.59    & 16.59 & 13205 & 2 & 36    \\
\hline
\end{tabular}
\caption{Esquema de renderização multimodal com glifos de ODF renderizados em uma imagem $850\times 850$. Fig. \ref{fig::qualidade_visual_longe_lowres} teve em sua geração, os parâmetros da última linha da tabela.}
\label{tab::glyph_info_experiment}
\end{table}
\end{apendicesenv}
% ---


% ----------------------------------------------------------
% Anexos
% ----------------------------------------------------------

% ---
% Inicia os anexos
% ---
\begin{anexosenv}
\end{anexosenv}

%---------------------------------------------------------------------
% INDICE REMISSIVO
%---------------------------------------------------------------------
%\phantompart
\printindex
%---------------------------------------------------------------------

\end{document}


